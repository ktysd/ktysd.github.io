<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.10.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="ja" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>GNU Octave 3.0.5 版 - 吉田の教材文庫</title>
<meta name="description" content="講義と書籍のサポートページ">



<meta property="og:type" content="website">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="吉田の教材文庫">
<meta property="og:title" content="GNU Octave 3.0.5 版">
<meta property="og:url" content="http://edu.katzlab.jp/books/ds/octave/">













<link rel="canonical" href="http://edu.katzlab.jp/books/ds/octave/">













<!-- end _includes/seo.html -->


<link href="http://edu.katzlab.jp/feed.xml" type="application/atom+xml" rel="alternate" title="吉田の教材文庫 Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://edu.katzlab.jp/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" href="/favicon.ico">
<!-- end custom head snippets -->

  </head>

  <body class="layout--ktysd">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://edu.katzlab.jp/">吉田の教材文庫</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://www.katzlab.jp" >>> 研究室のページ</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">メニュー</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      

<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">メニュー</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="http://edu.katzlab.jp/books/"><span class="nav__sub-title">書籍サポート</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/books/ds/" class="">動的システム入門</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/books/tz/" class="">解くための材料力学</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="http://edu.katzlab.jp/lec/scilab/"><span class="nav__sub-title">Scilab 超入門</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/scilab/1/" class="">Scilab の基本操作</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/scilab/2/" class="">各種演算など</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/scilab/3/" class="">プログラム・ファイルの作成</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/scilab/4/" class="">プログラム・ファイルの実行</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/scilab/5/" class="">グラフの印刷</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="http://edu.katzlab.jp/lec/"><span class="nav__sub-title">講義資料</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/mdyn/" class="">機械力学</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/robo/" class="">ロボット力学</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/mc/" class="">ロボット力学特論</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/kalman/" class="">ランダム現象と状態推定</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/vib7h/" class="">Excelで学ぶ振動基礎(7h)</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/dsys/" class="">動的システム@宮崎大学</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/hoso/" class="">動的平衡と複雑系の科学</a></li>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/lec/kyoin/" class="">教員免許更新講習</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">その他資料</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="http://edu.katzlab.jp/misc/" class="">ファイル置き場</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="GNU Octave 3.0.5 版">
    
    
    

    <div class="page__inner-wrap">

  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
    
      
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://edu.katzlab.jp/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://edu.katzlab.jp/books" itemprop="item"><span itemprop="name">Books</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://edu.katzlab.jp/books/ds" itemprop="item"><span itemprop="name">Ds</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
      
        <li class="current">GNU Octave 3.0.5 版</li>
      
    
  </ol>
</nav>

  


      
        <header>
          
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> 目次</h4></header>
              <ul class="toc__menu">
  <li><a href="#code-1-pendm">Code 1 “pend.m”</a></li>
  <li><a href="#code-2-vectorfieldm">Code 2 “vectorfield.m”</a></li>
  <li><a href="#code-3-pendvecm">Code 3 “pendvec.m”</a></li>
  <li><a href="#code-4-pendveclm">Code 4 “pendvecL.m”</a></li>
  <li><a href="#code-5-expatm">Code 5 “expAt.m”</a></li>
  <li><a href="#code-6-expat2m">Code 6 “expAt2.m”</a></li>
  <li><a href="#code-7-modexpm">Code 7 “modexp.m”</a></li>
  <li><a href="#code-8-wmatm">Code 8 “Wmat.m”</a></li>
  <li><a href="#code-9-ctrbformm">Code 9 “ctrbform.m”</a></li>
  <li><a href="#code-10-eigplacem">Code 10 “eigplace.m”</a></li>
  <li><a href="#code-11-mckm">Code 11 “mck.m”</a></li>
  <li><a href="#code-12-dyndampm">Code 12 “dyndamp.m”</a></li>
  <li><a href="#code-13-optbvpm">Code 13 “optbvp.m”</a></li>
  <li><a href="#code-14-optricm">Code 14 “optRic.m”</a></li>
  <li><a href="#code-15-optlqrm">Code 15 “optlqr.m”</a></li>
  <li><a href="#code-16-invpm">Code 16 “invp.m”</a></li>
  <li><a href="#code-17-invpgainm">Code 17 “invpGain.m”</a></li>
  <li><a href="#code-18-invplqrm">Code 18 “invpLQR.m”</a></li>
  <li><a href="#code-19-pendvec-pfm">Code 19 “pendvec-pf.m”</a></li>
  <li><a href="#code-20-pendvec-snm">Code 20 “pendvec-sn.m”</a></li>
  <li><a href="#code-21-pend-jumpm">Code 21 “pend-jump.m”</a></li>
  <li><a href="#code-22-crane-hopfm">Code 22 “crane-hopf.m”</a></li>
  <li><a href="#code-23-newtonm">Code 23 “newton.m”</a></li>
  <li><a href="#code-24-circlem">Code 24 “circle.m”</a></li>
  <li><a href="#code-25-bdsn-inim">Code 25 “bdsn-ini.m”</a></li>
  <li><a href="#code-26-bdsn-contm">Code 26 “bdsn-cont.m”</a></li>
  <li><a href="#code-27-bdsn-stabm">Code 27 “bdsn-stab.m”</a></li>
  <li><a href="#code-28-crane-hopfbdm">Code 28 “crane-hopfbd.m”</a></li>
  <li><a href="#code-29-fpen_pocc">Code 29 “fpen_po.cc”</a></li>
  <li><a href="#code-30-fpen-trajm">Code 30 “fpen-traj.m”</a></li>
  <li><a href="#code-31-fpen-bdm">Code 31 “fpen-bd.m”</a></li>
  <li><a href="#code-32-fpen-poincarem">Code 32 “fpen-poincare.m”</a></li>
  <li><a href="#code-33-fpen_polincc">Code 33 “fpen_polin.cc”</a></li>
  <li><a href="#code-34-fpen-stabm">Code 34 “fpen-stab.m”</a></li>
  <li><a href="#code-35-fpen-stabpfm">Code 35 “fpen-stabpf.m”</a></li>
  <li><a href="#code-36-fpen_lyapcc">Code 36 “fpen_lyap.cc”</a></li>
  <li><a href="#code-37-fpen-lyapm">Code 37 “fpen-lyap.m”</a></li>
  <li><a href="#code-38-fpen-lyapbdm">Code 38 “fpen-lyapbd.m”</a></li>
</ul>
            </nav>
          </aside>
        
        <p>Octave 3.0.5 (Linux) で動作確認したプログラム例です．</p>

<p>実行環境によっては，簡易アニメが滑らかに動かない場合があるそうです（plot の仕様変更？）．実行環境の違いにより，皆様の不具合を当方が再現できず，有効な対策をご提案できないケースが起こりそうですが，その点ご容赦下さい． m(_ _)m</p>

<h3 id="code-1-pendm">Code 1 “<a href="pend.m">pend.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pend</span><span class="o">.</span><span class="n">m</span><span class="err">"　　ここはコメント行．#～行末を</span><span class="n">Octave</span><span class="err">は無視する</span>
<span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>  <span class="err">#大域変数の宣言</span>
<span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eqn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span> <span class="err">#関数の中から大域変数を参照する宣言</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">/(</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">g</span><span class="p">/</span><span class="n">l</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="n">endfunction</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="nb">pi</span><span class="p">/</span><span class="mi">5</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>             <span class="err">#初期値．</span><span class="nb">pi</span> <span class="err">は円周率</span>
<span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>                   <span class="err">#時間のきざみ数</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>     <span class="err">#時間</span><span class="mi">0</span><span class="err">～</span><span class="mi">10</span><span class="err">の等比数列</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eqn</span><span class="err">"</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span> <span class="err">#常微分方程式"</span><span class="n">eqn</span><span class="err">"を解く</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>  <span class="err">#簡易アニメーション</span>
 <span class="n">theta</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>          <span class="err">#第</span><span class="mi">1</span><span class="err">変数が角度</span>
 <span class="nb">plot</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="err">#線分のプロット</span>
 <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">'square'</span><span class="p">);</span>    <span class="err">#座標軸の設定</span>
 <span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="n">xxxxx</span><span class="p">:</span> <span class="c1">%d",i)); #タイトルの設定</span>
 <span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span>
 <span class="k">if</span> <span class="p">(</span> <span class="nb">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   <span class="err">#初回は</span><span class="mi">1</span><span class="err">秒待機</span>
 <span class="k">else</span> <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">endif</span>  <span class="err">#この数値でアニメーション速度を調整</span>
<span class="n">endfor</span>
</code></pre></div></div>

<h3 id="code-2-vectorfieldm">Code 2 “<a href="vectorfield.m">vectorfield.m</a>”</h3>
<p><font color="red">※Code 3, 4 の実行に必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">vectorfield</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">function</span> <span class="n">vectorfield</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">scal</span><span class="p">)</span>
 <span class="n">xx</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">nx</span><span class="p">);</span>
 <span class="n">yy</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ny</span><span class="p">);</span>
 <span class="n">uu</span><span class="o">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">);</span> <span class="n">vv</span><span class="o">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">);</span>
 <span class="k">for</span> <span class="n">ix</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span>
  <span class="k">for</span> <span class="n">iy</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span>
   <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">xx</span><span class="p">(</span><span class="n">ix</span><span class="p">),</span><span class="n">yy</span><span class="p">(</span><span class="n">iy</span><span class="p">)];</span>
   <span class="nb">eval</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="n">dx</span><span class="o">=</span><span class="c1">%s([xx(ix),yy(iy)],0);",func));#dx = eqn(x,0);</span>
   <span class="n">uu</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">)</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">vv</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">)</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">endfor</span>
 <span class="n">endfor</span>
 <span class="nb">quiver</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">scal</span><span class="p">,</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">);</span>
<span class="n">endfunction</span>
</code></pre></div></div>

<h3 id="code-3-pendvecm">Code 3 “<a href="pendvec.m">pendvec.m</a>”</h3>
<p><font color="red">※同じフォルダに，Code 2を書き込んだファイル vectorfield.m が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pendvec</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>
<span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">/(</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">g</span><span class="p">/</span><span class="n">l</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="n">endfunction</span>
<span class="n">nx</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span> <span class="n">ny</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">];</span> <span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="n">vectorfield</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,[</span><span class="mf">1.2</span><span class="p">;</span><span class="mi">6</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,[</span><span class="mf">1.4</span><span class="p">;</span><span class="mi">6</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">plot</span><span class="p">([</span><span class="nb">pi</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span><span class="err">"</span><span class="n">ko</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dx</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-4-pendveclm">Code 4 “<a href="pendvecL.m">pendvecL.m</a>”</h3>
<p><font color="red">※同じフォルダに，Code 2を書き込んだファイル vectorfield.m が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pendvecL</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>
<span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dv</span><span class="o">=</span><span class="n">eom_v</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>
 <span class="n">dv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dv</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">/(</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">g</span><span class="p">/</span><span class="n">l</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">dw</span><span class="o">=</span><span class="n">eom_w</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">m</span> <span class="n">l</span> <span class="n">c</span> <span class="n">g</span><span class="p">;</span>
 <span class="n">dw</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">/(</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">g</span><span class="p">/</span><span class="n">l</span><span class="o">*</span><span class="n">w</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="n">nx</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span> <span class="n">ny</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
<span class="n">vectorfield</span><span class="p">(</span><span class="err">"</span><span class="n">eom_v</span><span class="err">"</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom_v</span><span class="err">"</span><span class="p">,[</span><span class="mf">0.5</span><span class="p">;</span><span class="o">-</span><span class="mf">4.8</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span> <span class="err">#</span><span class="p">[</span><span class="mf">1.2</span><span class="p">;</span><span class="mi">6</span><span class="p">]</span>
<span class="nb">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],[</span><span class="o">-</span><span class="mf">4.8</span><span class="p">],</span><span class="err">"</span><span class="n">ko</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">v</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">42</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dv</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">42</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="nb">pi</span><span class="p">,</span><span class="mi">8</span><span class="o">-</span><span class="nb">pi</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
<span class="n">vectorfield</span><span class="p">(</span><span class="err">"</span><span class="n">eom_w</span><span class="err">"</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">([</span><span class="mf">1.4</span><span class="o">-</span><span class="nb">pi</span><span class="p">,</span><span class="mf">1.6</span><span class="o">-</span><span class="nb">pi</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="err">"</span><span class="n">ko</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom_w</span><span class="err">"</span><span class="p">,[</span><span class="mf">1.4</span><span class="o">-</span><span class="nb">pi</span><span class="p">;</span><span class="mi">6</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom_w</span><span class="err">"</span><span class="p">,[</span><span class="mf">1.6</span><span class="o">-</span><span class="nb">pi</span><span class="p">;</span><span class="mi">6</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'w=x-{\pi}'</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">42</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dw</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">42</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-5-expatm">Code 5 “<a href="expAt.m">expAt.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">expAt</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="n">A1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mf">9.8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">A2</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="mf">9.8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="n">xx</span><span class="o">=</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">;</span><span class="o">-</span><span class="mf">4.8</span><span class="p">];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">200</span>
 <span class="n">xx</span><span class="p">(:,</span><span class="nb">i</span><span class="p">)</span><span class="o">=</span><span class="nb">expm</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">tt</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">*</span><span class="n">x0</span><span class="p">;</span>
<span class="n">endfor</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,:),</span><span class="n">xx</span><span class="p">(</span><span class="mi">2</span><span class="p">,:),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">]);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">x0a</span><span class="o">=</span><span class="p">[</span><span class="mf">1.4</span><span class="o">-</span><span class="nb">pi</span><span class="p">;</span><span class="mi">6</span><span class="p">];</span> <span class="n">x0b</span><span class="o">=</span><span class="p">[</span><span class="mf">1.6</span><span class="o">-</span><span class="nb">pi</span><span class="p">;</span><span class="mi">6</span><span class="p">];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">200</span>
 <span class="n">xxa</span><span class="p">(:,</span><span class="nb">i</span><span class="p">)</span><span class="o">=</span><span class="nb">expm</span><span class="p">(</span><span class="n">A2</span><span class="o">*</span><span class="n">tt</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">*</span><span class="n">x0a</span><span class="p">;</span>
 <span class="n">xxb</span><span class="p">(:,</span><span class="nb">i</span><span class="p">)</span><span class="o">=</span><span class="nb">expm</span><span class="p">(</span><span class="n">A2</span><span class="o">*</span><span class="n">tt</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">*</span><span class="n">x0b</span><span class="p">;</span>
<span class="n">endfor</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xxa</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">.+</span><span class="nb">pi</span><span class="p">,</span><span class="n">xxa</span><span class="p">(</span><span class="mi">2</span><span class="p">,:),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xxb</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">.+</span><span class="nb">pi</span><span class="p">,</span><span class="n">xxb</span><span class="p">(</span><span class="mi">2</span><span class="p">,:),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dx</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-6-expat2m">Code 6 “<a href="expAt2.m">expAt2.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">expAt2</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mf">9.8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="k">function</span> <span class="n">dX</span><span class="o">=</span><span class="n">eqn</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span><span class="p">;</span>
 <span class="n">Xmat</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">A</span><span class="p">));</span> <span class="err">#行列化</span>
 <span class="n">dXmat</span><span class="o">=</span><span class="n">A</span><span class="o">*</span><span class="n">Xmat</span><span class="p">;</span> <span class="err">#行列微分方程式</span>
 <span class="n">dX</span><span class="o">=</span><span class="n">dXmat</span><span class="p">(:);</span> <span class="err">#ベクトル化</span>
<span class="n">endfunction</span>
<span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">X0mat</span><span class="o">=</span><span class="nb">eye</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">A</span><span class="p">));</span>
<span class="n">X0</span><span class="o">=</span><span class="n">X0mat</span><span class="p">(:);</span> <span class="err">#ベクトル化</span>
<span class="n">XX</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eqn</span><span class="err">"</span><span class="p">,</span><span class="n">X0</span><span class="p">,</span><span class="n">tt</span><span class="p">);</span>
<span class="n">Xmat</span><span class="o">=</span><span class="nb">reshape</span><span class="p">(</span><span class="n">XX</span><span class="p">(</span><span class="n">n</span><span class="p">,:),</span><span class="nb">size</span><span class="p">(</span><span class="n">A</span><span class="p">))</span> <span class="err">#手製の数値解</span>
<span class="nb">expm</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="err">#組み込みの行列指数関数</span>
</code></pre></div></div>

<h3 id="code-7-modexpm">Code 7 “<a href="modexp.m">modexp.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">modexp</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">Adiag</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">];</span>
<span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">/</span><span class="nb">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span> <span class="err">#</span><span class="n">unit</span> <span class="n">vector</span>
<span class="n">v2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span> <span class="n">v2</span><span class="o">=</span><span class="n">v2</span><span class="p">/</span><span class="nb">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span> <span class="err">#</span><span class="n">unit</span> <span class="n">vector</span>
<span class="n">T</span><span class="o">=</span><span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">];</span> <span class="err">#</span><span class="n">change</span> <span class="n">of</span> <span class="n">basis</span> <span class="n">matrix</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">Adiag</span><span class="o">=</span><span class="nb">inv</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">T</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dy</span><span class="o">=</span><span class="n">eos_mode</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">Adiag</span><span class="p">;</span>
 <span class="n">dy</span> <span class="o">=</span> <span class="n">Adiag</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">y0</span><span class="o">=</span><span class="nb">inv</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">x0</span><span class="p">;</span>
<span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="n">yy</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos_mode</span><span class="err">"</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="n">zz</span><span class="o">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
 <span class="n">zz</span><span class="p">(</span><span class="nb">i</span><span class="p">,:)</span><span class="o">=</span><span class="p">(</span><span class="n">yy</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span> <span class="n">yy</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">v2</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
<span class="n">endfor</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span> <span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span> <span class="n">zz</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">zz</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="n">ko</span><span class="p">;</span><span class="n">y_1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">v_1</span><span class="o">+</span><span class="n">y_2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">v_2</span><span class="p">;</span><span class="err">"</span> <span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x_1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x_2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span> <span class="n">yy</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">yy</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span> <span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">y_1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">y_2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-8-wmatm">Code 8 “<a href="Wmat.m">Wmat.m</a>”</h3>
<p><font color="red">※Code 9 の実行に必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">Wmat</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">function</span> <span class="n">W</span> <span class="o">=</span> <span class="n">Wmat</span><span class="p">(</span> <span class="n">aa</span> <span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">aa</span><span class="p">);</span>  <span class="err">#固有方程式の次数</span>
  <span class="n">W</span><span class="o">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
  <span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
    <span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nb">i</span><span class="o">+</span><span class="nb">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
        <span class="n">W</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">aa</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="nb">j</span><span class="p">);</span>
      <span class="k">elseif</span> <span class="p">(</span> <span class="nb">i</span><span class="o">+</span><span class="nb">j</span> <span class="o">==</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>
        <span class="n">W</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">endif</span>
    <span class="n">endfor</span>
  <span class="n">endfor</span>
<span class="n">endfunction</span>
</code></pre></div></div>

<h3 id="code-9-ctrbformm">Code 9 “<a href="ctrbform.m">ctrbform.m</a>”</h3>
<p><font color="red">※同じフォルダに，Code 8を書き込んだファイル Wmat.m が必要．</font></p>
<p><font color="red">※実行結果の -0 は 0 のこと．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">ctrbform</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">function</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">chop</span> <span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="err">#計算機誤差の除去</span>
  <span class="nb">eps</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">;</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">eps</span><span class="p">)</span><span class="o">.*</span><span class="n">x</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="err">システム行列</span> <span class="err">###</span>
<span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">bb</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="err">###</span> <span class="err">可制御性行列</span> <span class="err">###</span>
<span class="n">Uc</span><span class="o">=</span><span class="p">[</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">];</span>
<span class="err">###</span> <span class="err">行列</span><span class="n">A</span><span class="err">の固有方程式</span> <span class="err">###</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="err">#</span> <span class="n">aa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(n)*s +aa(n+1), a(1)=1</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">aa</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">)</span> <span class="err">#テキスト順</span> <span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(1)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">Wmat</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
<span class="err">###</span> <span class="err">基底変換行列</span> <span class="err">###</span>
<span class="n">Tc</span><span class="o">=</span><span class="n">Uc</span><span class="o">*</span><span class="n">W</span>
<span class="err">###</span> <span class="err">コンパニオン行列</span> <span class="err">###</span>
<span class="n">Ac</span><span class="o">=</span><span class="n">chop</span><span class="p">(</span><span class="nb">inv</span><span class="p">(</span><span class="n">Tc</span><span class="p">)</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">Tc</span><span class="p">)</span>
<span class="n">bbc</span><span class="o">=</span><span class="n">chop</span><span class="p">(</span><span class="nb">inv</span><span class="p">(</span><span class="n">Tc</span><span class="p">)</span><span class="o">*</span><span class="n">bb</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="code-10-eigplacem">Code 10 “<a href="eigplace.m">eigplace.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">eigplace</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKp</span>
<span class="err">###</span> <span class="err">システム行列</span> <span class="err">###</span>
<span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">bb</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="err">###</span> <span class="err">可制御性行列</span> <span class="err">###</span>
<span class="n">Uc</span><span class="o">=</span><span class="p">[</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">];</span>
<span class="err">###</span> <span class="err">行列</span><span class="n">A</span><span class="err">の固有方程式</span> <span class="err">###</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="err">#</span> <span class="n">aa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(n)*s +aa(n+1), a(1)=1</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">aa</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">);</span> <span class="err">#テキスト順</span> <span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(1)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">Wmat</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
<span class="err">###</span> <span class="err">基底変換行列</span> <span class="err">###</span>
<span class="n">Tc</span><span class="o">=</span><span class="n">Uc</span><span class="o">*</span><span class="n">W</span><span class="p">;</span>
<span class="err">###</span> <span class="err">目標の固有値と固有方程式</span> <span class="err">###</span>
<span class="n">ss</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="nb">i</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="nb">i</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">cc</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="nb">diag</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span> <span class="n">cc</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">cc</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">);</span> <span class="err">#テキスト順</span>
<span class="err">###</span> <span class="err">ゲイン</span> <span class="err">###</span>
<span class="n">KKp</span><span class="o">=</span><span class="p">(</span><span class="n">cc</span><span class="o">-</span><span class="n">aa</span><span class="p">)</span><span class="o">*</span><span class="nb">inv</span><span class="p">(</span><span class="n">Tc</span><span class="p">);</span>
<span class="err">###</span> <span class="err">検算</span><span class="p">(</span><span class="err">閉ループ系の固有値</span><span class="p">)</span> <span class="err">###</span>
<span class="nb">eig</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">bb</span><span class="o">*</span><span class="n">KKp</span><span class="p">)</span>
<span class="err">###</span> <span class="err">シミュレーション</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKp</span><span class="p">;</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KKp</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">bb</span><span class="o">*</span><span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,[</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">,[</span><span class="err">"</span><span class="p">;</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x3</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-11-mckm">Code 11 “<a href="mck.m">mck.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">mck</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">k</span> <span class="n">c</span> <span class="n">omeg</span><span class="p">;</span>
<span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>
<span class="err">###</span> <span class="err">シミュレーションから計測した振幅比</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">k</span> <span class="n">c</span> <span class="n">omeg</span><span class="p">;</span>
 <span class="n">A</span><span class="o">=</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">;</span> <span class="k">...</span>
    <span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="p">];</span>
 <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
 <span class="n">ut</span><span class="o">=</span><span class="nb">cos</span><span class="p">(</span><span class="n">omeg</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
 <span class="n">dx</span><span class="o">=</span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">omn</span><span class="o">=</span><span class="mi">51</span><span class="p">;</span> <span class="n">freq1</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="n">omn</span><span class="p">);</span>
<span class="n">xpp</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="n">omi</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">omn</span><span class="p">;</span>
 <span class="n">omeg</span><span class="o">=</span><span class="n">freq1</span><span class="p">(</span><span class="n">omi</span><span class="p">);</span>
 <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span>
 <span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="mi">50</span><span class="p">);</span>
 <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="o">@</span><span class="n">eom</span><span class="p">,[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
 <span class="n">tti</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="o">*</span><span class="mi">45</span><span class="p">:</span><span class="mi">20</span><span class="o">*</span><span class="mi">50</span><span class="p">];</span> <span class="err">#終端時刻付近のデータ番号</span>
 <span class="n">steady</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="n">tti</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>  <span class="err">#定常応答</span>
 <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="nb">cos</span><span class="p">(</span><span class="n">omeg</span><span class="o">*</span><span class="n">tt</span><span class="p">),</span> <span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span> <span class="k">...</span><span class="c"> #入力</span>
      <span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span>  <span class="k">...</span><span class="c"> #応答</span>
      <span class="n">tt</span><span class="p">(</span><span class="n">tti</span><span class="p">),</span><span class="n">steady</span><span class="p">,</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">);</span> <span class="err">#</span><span class="n">p</span><span class="o">-</span><span class="n">p</span><span class="err">の計測点</span>
 <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span>
 <span class="nb">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]);</span>
 <span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="p">{/</span><span class="n">Symbol</span> <span class="n">w</span><span class="p">}</span><span class="o">=</span><span class="c1">%f",omeg));</span>
 <span class="nb">drawnow</span><span class="p">();</span> <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
 <span class="k">switch</span> <span class="p">(</span><span class="n">omi</span><span class="p">)</span>
  <span class="k">case</span> <span class="mi">1</span>
   <span class="nb">title</span><span class="p">(</span><span class="err">""</span><span class="p">);</span> <span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">mck_01</span><span class="o">.</span><span class="nb">eps</span>
  <span class="k">case</span> <span class="mi">26</span>
   <span class="nb">title</span><span class="p">(</span><span class="err">""</span><span class="p">);</span> <span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">mck_26</span><span class="o">.</span><span class="nb">eps</span>
  <span class="k">case</span> <span class="mi">51</span>
   <span class="nb">title</span><span class="p">(</span><span class="err">""</span><span class="p">);</span> <span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">mck_51</span><span class="o">.</span><span class="nb">eps</span>
 <span class="n">endswitch</span>
 <span class="n">pp</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">steady</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">steady</span><span class="p">);</span>
 <span class="n">xpp</span><span class="o">=</span><span class="p">[</span><span class="n">xpp</span><span class="p">;</span><span class="n">pp</span><span class="p">/</span><span class="mi">2</span><span class="p">];</span>
<span class="n">endfor</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">freq1</span><span class="p">,</span><span class="n">xpp</span><span class="p">,</span><span class="err">"</span><span class="n">o</span><span class="p">;</span><span class="n">x_</span><span class="p">{</span><span class="n">p</span><span class="o">-</span><span class="n">p</span><span class="p">}/</span><span class="mi">2</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="p">{/</span><span class="n">Symbol</span> <span class="n">w</span><span class="p">}</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">R</span><span class="err">"</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">]);</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="err">###</span> <span class="err">伝達関数で計算した振幅比</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">k</span> <span class="n">c</span><span class="p">;</span>
 <span class="n">A</span><span class="o">=</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">;</span> <span class="k">...</span>
    <span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="p">];</span>
 <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
 <span class="n">I</span><span class="o">=</span><span class="nb">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="err">#単位行列</span>
 <span class="nb">inv</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">I</span><span class="o">-</span><span class="n">A</span><span class="p">);</span>
 <span class="n">y</span><span class="o">=</span><span class="nb">inv</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">I</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">freq2</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span> <span class="n">RR</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span>
  <span class="n">omeg</span><span class="o">=</span><span class="n">freq2</span><span class="p">(</span><span class="nb">j</span><span class="p">);</span>
  <span class="n">Giw</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="o">*</span><span class="n">omeg</span><span class="p">);</span>
  <span class="n">R</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">Giw</span><span class="p">);</span>   <span class="err">#振幅比</span> <span class="p">(</span><span class="err">変位</span><span class="p">,</span><span class="err">速度</span><span class="p">)</span>
  <span class="n">phi</span><span class="o">=</span><span class="n">arg</span><span class="p">(</span><span class="n">Giw</span><span class="p">);</span> <span class="err">#位相差</span> <span class="p">(</span><span class="err">変位</span><span class="p">,</span><span class="err">速度</span><span class="p">)</span>
  <span class="n">RR</span><span class="o">=</span><span class="p">[</span><span class="n">RR</span><span class="p">,</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span> <span class="err">#振幅比</span> <span class="p">(</span><span class="err">変位</span><span class="p">)</span>
<span class="n">endfor</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">freq2</span><span class="p">,</span><span class="n">RR</span><span class="p">,</span><span class="err">"</span><span class="n">r</span><span class="o">-</span><span class="p">;</span><span class="o">|</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="p">{/</span><span class="n">Symbol</span> <span class="n">w</span><span class="p">})</span><span class="o">|</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'{/Symbol w}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'R'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">]);</span>
<span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">mck_R</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-12-dyndampm">Code 12 “<a href="dyndamp.m">dyndamp.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">dyndamp</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">k</span> <span class="n">c</span> <span class="n">kmu</span> <span class="n">cmu</span> <span class="n">mu</span><span class="p">;</span>
<span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span> <span class="n">kmu</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">cmu</span><span class="o">=</span><span class="mf">0.01</span><span class="p">;</span>
<span class="n">mu</span><span class="o">=</span><span class="mf">0.05</span><span class="p">;</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">k</span> <span class="n">c</span> <span class="n">kmu</span> <span class="n">cmu</span> <span class="n">mu</span><span class="p">;</span>
 <span class="n">A</span><span class="o">=</span><span class="p">[</span>      <span class="mi">0</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">;</span> <span class="k">...</span>
     <span class="o">-</span><span class="n">k</span><span class="o">-</span><span class="n">kmu</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">cmu</span><span class="p">,</span>     <span class="n">kmu</span><span class="p">,</span>     <span class="n">cmu</span><span class="p">;</span> <span class="k">...</span>
          <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>      <span class="mi">1</span><span class="p">;</span> <span class="k">...</span>
      <span class="n">kmu</span><span class="p">/</span><span class="n">mu</span><span class="p">,</span>  <span class="n">cmu</span><span class="p">/</span><span class="n">mu</span><span class="p">,</span> <span class="o">-</span><span class="n">kmu</span><span class="p">/</span><span class="n">mu</span><span class="p">,</span> <span class="o">-</span><span class="n">cmu</span><span class="p">/</span><span class="n">mu</span> <span class="p">];</span>
 <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
 <span class="n">I</span><span class="o">=</span><span class="nb">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="err">#単位行列</span>
 <span class="nb">inv</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">I</span><span class="o">-</span><span class="n">A</span><span class="p">);</span>
 <span class="n">y</span><span class="o">=</span><span class="nb">inv</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">I</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="mi">2</span><span class="err">つ目のばねが硬い場合</span> <span class="err">###</span>
<span class="n">kmu</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="err">#硬くして一体で動かす</span>
<span class="n">omm</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="n">RR1</span><span class="o">=</span><span class="p">[];</span> <span class="n">Phi1</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span>
  <span class="n">omeg</span><span class="o">=</span><span class="n">omm</span><span class="p">(</span><span class="nb">j</span><span class="p">);</span>
  <span class="n">Giw</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="o">*</span><span class="n">omeg</span><span class="p">);</span>
  <span class="n">Giw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="n">Giw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">Giw</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="err">#相対変位</span>
  <span class="n">Giw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="n">Giw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">Giw</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="err">#相対速度</span>
  <span class="n">R</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">Giw</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>   <span class="err">#振幅比</span>
  <span class="n">phi</span><span class="o">=</span><span class="n">arg</span><span class="p">(</span><span class="n">Giw</span><span class="p">)</span><span class="o">'</span><span class="p">;</span> <span class="err">#位相差</span>
  <span class="n">RR1</span><span class="o">=</span><span class="p">[</span><span class="n">RR1</span><span class="p">;</span><span class="n">R</span><span class="p">];</span> <span class="n">Phi1</span><span class="o">=</span><span class="p">[</span><span class="n">Phi1</span><span class="p">;</span><span class="n">phi</span><span class="p">];</span>
<span class="n">endfor</span>
<span class="err">###</span> <span class="mi">2</span><span class="err">つ目のばね・減衰器を最適調整した場合</span> <span class="err">###</span>
<span class="n">kmu</span><span class="o">=</span><span class="n">mu</span><span class="p">/(</span><span class="mi">1</span><span class="o">+</span><span class="n">mu</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="n">cmu</span><span class="o">=</span><span class="n">kmu</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">/</span><span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">mu</span><span class="p">))</span>
<span class="n">RR2</span><span class="o">=</span><span class="p">[];</span> <span class="n">Phi2</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span>
  <span class="n">omeg</span><span class="o">=</span><span class="n">omm</span><span class="p">(</span><span class="nb">j</span><span class="p">);</span>
  <span class="n">Giw</span><span class="o">=</span><span class="n">G</span><span class="p">(</span><span class="nb">i</span><span class="o">*</span><span class="n">omeg</span><span class="p">);</span>
  <span class="n">phi</span><span class="o">=</span><span class="n">arg</span><span class="p">(</span><span class="n">Giw</span><span class="p">)</span><span class="o">'</span><span class="p">;</span> <span class="err">#位相差</span>
  <span class="n">Giw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="n">Giw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">Giw</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="err">#相対変位</span>
  <span class="n">Giw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">=</span><span class="n">Giw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">Giw</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="err">#相対速度</span>
  <span class="n">R</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">Giw</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>   <span class="err">#振幅比</span> <span class="err">↑</span> <span class="err">ここで差をとってはダメ</span>
  <span class="n">RR2</span><span class="o">=</span><span class="p">[</span><span class="n">RR2</span><span class="p">;</span><span class="n">R</span><span class="p">];</span> <span class="n">Phi2</span><span class="o">=</span><span class="p">[</span><span class="n">Phi2</span><span class="p">;</span><span class="n">phi</span><span class="p">];</span>
<span class="n">endfor</span>
<span class="err">###</span> <span class="err">振幅比のグラフ</span> <span class="err">###</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">RR1</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">r</span><span class="o">-</span><span class="p">;</span><span class="n">R_1</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">RR1</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span><span class="err">"</span><span class="n">bo</span><span class="p">;</span><span class="n">R</span><span class="s1">'_3;",'</span><span class="n">markersize</span><span class="o">'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'{/Symbol w}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'R'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">120</span><span class="p">]);</span>
<span class="nb">drawnow</span><span class="p">();</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">dyndamp1</span><span class="o">.</span><span class="nb">eps</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">RR2</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">r</span><span class="o">-</span><span class="p">;</span><span class="n">R_1</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">RR2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span><span class="err">"</span><span class="n">bo</span><span class="p">;</span><span class="n">R</span><span class="s1">'_3;",'</span><span class="n">markersize</span><span class="o">'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'{/Symbol w}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'R'</span><span class="p">);</span> <span class="err">#</span><span class="nb">axis</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">]);</span>
<span class="nb">drawnow</span><span class="p">();</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">dyndamp2</span><span class="o">.</span><span class="nb">eps</span>
<span class="err">###</span> <span class="err">位相差のグラフ</span> <span class="err">###</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">Phi1</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">r</span><span class="o">-</span><span class="p">;{/</span><span class="n">Symbol</span> <span class="n">f</span><span class="p">}</span><span class="err">_</span><span class="mi">1</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">Phi2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">Phi2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.-</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">Phi1</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span><span class="err">"</span><span class="n">bo</span><span class="p">;{/</span><span class="n">Symbol</span> <span class="n">f</span><span class="p">}</span><span class="s1">'_3;",'</span><span class="n">markersize</span><span class="o">'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'{/Symbol w}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{/Symbol f}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="nb">pi</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">dyndamp_phi1</span><span class="o">.</span><span class="nb">eps</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">Phi2</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">r</span><span class="o">-</span><span class="p">;{/</span><span class="n">Symbol</span> <span class="n">f</span><span class="p">}</span><span class="err">_</span><span class="mi">1</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">Phi2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">Phi2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">)</span><span class="o">.-</span> <span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">omm</span><span class="p">,</span><span class="n">Phi2</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span><span class="err">"</span><span class="n">bo</span><span class="p">;{/</span><span class="n">Symbol</span> <span class="n">f</span><span class="p">}</span><span class="s1">'_3;",'</span><span class="n">markersize</span><span class="o">'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'{/Symbol w}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{/Symbol f}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">dyndamp_phi2</span><span class="o">.</span><span class="nb">eps</span>
<span class="nb">save</span> <span class="n">dyndamp</span><span class="o">.</span><span class="n">dat</span> <span class="n">RR1</span> <span class="n">RR2</span> <span class="n">Phi2</span>
</code></pre></div></div>

<h3 id="code-13-optbvpm">Code 13 “<a href="optbvp.m">optbvp.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">optbvp</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">t1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">q</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">global</span> <span class="n">A</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">^</span><span class="mi">2</span><span class="p">/(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">);</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">];</span>
<span class="n">expA</span><span class="o">=</span><span class="nb">expm</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">t1</span><span class="p">);</span>
<span class="n">aa1</span><span class="o">=</span><span class="n">expA</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span> <span class="n">aa2</span><span class="o">=</span><span class="n">expA</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span> <span class="n">ee1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span> <span class="n">ee2</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="err">#</span> <span class="err">両端固定</span> <span class="k">...</span><span class="c"> x0 x1 既知</span>
<span class="n">x0</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">x1</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">p0p1</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">aa2</span><span class="p">,</span><span class="n">ee2</span><span class="p">]\(</span><span class="n">x0</span><span class="o">*</span><span class="n">aa1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">ee1</span><span class="p">);</span> <span class="err">##</span> <span class="n">p</span> <span class="k">...</span><span class="c"> lamda</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,[</span><span class="n">x0</span><span class="p">;</span><span class="n">p0p1</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="n">tt</span><span class="p">);</span>
<span class="n">uu</span><span class="o">=-</span><span class="n">b</span><span class="p">/(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="err">"</span><span class="n">Both</span> <span class="n">sides</span> <span class="n">fixed</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">uu</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">u</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="err">#</span> <span class="err">終端自由</span> <span class="k">...</span><span class="c"> x0 p1 既知</span>
<span class="n">x0</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">p1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">p0x1</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">aa2</span><span class="p">,</span><span class="n">ee1</span><span class="p">]\(</span><span class="n">x0</span><span class="o">*</span><span class="n">aa1</span><span class="o">-</span><span class="n">p1</span><span class="o">*</span><span class="n">ee2</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,[</span><span class="n">x0</span><span class="p">;</span><span class="n">p0x1</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="n">tt</span><span class="p">);</span>
<span class="n">uu</span><span class="o">=-</span><span class="n">b</span><span class="p">/(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="err">"</span><span class="n">Free</span> <span class="n">endpoint</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">uu</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">u</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="n">xxb</span><span class="o">=</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span> <span class="n">uub</span><span class="o">=</span><span class="n">uu</span><span class="p">;</span> <span class="n">ttb</span><span class="o">=</span><span class="n">tt</span><span class="p">;</span> <span class="nb">save</span> <span class="err">"</span><span class="n">optbvp</span><span class="o">.</span><span class="n">dat</span><span class="err">"</span> <span class="n">xxb</span> <span class="n">uub</span> <span class="n">ttb</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-14-optricm">Code 14 “<a href="optRic.m">optRic.m</a>”</h3>
<p><font color="red">※先に，同じフォルダで Code 13 を実行しておく必要がある．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">optRic</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">a</span> <span class="n">b</span> <span class="n">q</span> <span class="n">r</span> <span class="n">tt</span> <span class="n">KK</span><span class="p">;</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">q</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">x0</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">t1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="err">#</span><span class="n">t1</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="err">#状態方程式</span>
 <span class="k">global</span> <span class="n">a</span> <span class="n">b</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span> <span class="n">K</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">dP</span><span class="o">=</span><span class="n">Riccati</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="err">#リッカチ方程式</span>
 <span class="k">global</span> <span class="n">a</span> <span class="n">b</span> <span class="n">q</span> <span class="n">r</span><span class="p">;</span>
 <span class="n">dP</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">P</span> <span class="o">-</span> <span class="n">P</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">b</span><span class="p">/</span><span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">P</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">y</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="err">#</span><span class="n">KK</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="k">...</span><span class="c">,KK(n) を補間して K(t) を求める</span>
 <span class="k">global</span> <span class="n">tt</span> <span class="n">KK</span><span class="p">;</span>
 <span class="n">y</span> <span class="o">=</span> <span class="nb">interp1</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">KK</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="err">#</span> <span class="err">リッカチ方程式を解く</span>
<span class="n">rt</span><span class="o">=</span><span class="n">tt</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">);</span>               <span class="err">#逆時間</span>
<span class="n">PP</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">Riccati</span><span class="err">"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rt</span><span class="p">);</span>    <span class="err">#</span><span class="n">P</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="err">の数列</span>
<span class="n">KK</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">PP</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">);</span>         <span class="err">#</span><span class="n">K</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="err">の数列</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">PP</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;;</span><span class="err">"</span><span class="p">,</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">P</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="err">#</span> <span class="err">状態方程式を解く</span> <span class="p">(</span><span class="err">終端自由</span><span class="p">)</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">);</span>       <span class="err">#</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="err">の数列</span>
<span class="nb">load</span> <span class="err">"</span><span class="n">optbvp</span><span class="o">.</span><span class="n">dat</span><span class="err">"</span><span class="p">;</span>           <span class="err">#</span><span class="n">optbvp</span><span class="o">.</span><span class="n">m</span> <span class="err">のデータを読む</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="err">"</span><span class="n">o</span><span class="p">;</span><span class="n">with</span> <span class="n">P</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="k">...</span>
     <span class="n">ttb</span><span class="p">,</span><span class="n">xxb</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">with</span> <span class="n">lam</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">,</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="n">uu</span><span class="o">=-</span><span class="n">KK</span><span class="o">.*</span><span class="n">xx</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">uu</span><span class="p">,</span><span class="err">"</span><span class="n">o</span><span class="p">;</span><span class="n">with</span> <span class="n">P</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="k">...</span>
     <span class="n">ttb</span><span class="p">,</span><span class="n">uub</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="p">;</span><span class="n">with</span> <span class="n">lam</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">,</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">t</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">u</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">,</span><span class="s1">'fontsize'</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="code-15-optlqrm">Code 15 “<a href="optlqr.m">optlqr.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">optlqr</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KK</span>
<span class="err">###</span> <span class="err">システム行列</span> <span class="err">###</span>
<span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">bb</span><span class="o">=</span><span class="nb">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="err">###</span> <span class="err">無限次元最適レギュレータ</span> <span class="err">###</span>
<span class="n">Q</span><span class="o">=</span><span class="nb">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span> <span class="err">#状態</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">の重み</span>
<span class="n">R</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>             <span class="err">#入力</span><span class="n">u</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">の重み</span>
<span class="p">[</span><span class="n">KK</span><span class="p">,</span><span class="n">PP</span><span class="p">,</span><span class="n">EE</span><span class="p">]</span><span class="o">=</span><span class="n">lqr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">R</span><span class="p">)</span> <span class="err">#最適レギュレータを求める</span>
<span class="err">###</span> <span class="err">シミュレーション</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KK</span><span class="p">;</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KK</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">bb</span><span class="o">*</span><span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,[</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">,[</span><span class="err">"</span><span class="o">-</span><span class="mi">0</span><span class="p">;</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="o">-</span><span class="mi">3</span><span class="p">;</span><span class="n">x3</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">],</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-16-invpm">Code 16 “<a href="invp.m">invp.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">invp</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">M</span> <span class="n">m</span> <span class="n">l</span> <span class="n">g</span> <span class="n">KK</span><span class="p">;</span>  <span class="err">#大域変数の宣言</span>
<span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="n">KK</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="err">#制御無し</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eqn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">M</span> <span class="n">m</span> <span class="n">l</span> <span class="n">g</span> <span class="n">KK</span><span class="p">;</span> <span class="err">#関数の中から大域変数を参照する宣言</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KK</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>  <span class="err">#制御入力</span>
 <span class="n">D</span><span class="o">=</span><span class="n">M</span><span class="o">*</span><span class="n">l</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">)/</span><span class="n">D</span> <span class="k">...</span>
         <span class="o">+</span> <span class="n">l</span><span class="p">/</span><span class="n">D</span> <span class="o">*</span> <span class="n">ut</span><span class="p">;</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span> <span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">)/</span><span class="n">D</span> <span class="k">...</span>
         <span class="o">-</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))/</span><span class="n">D</span> <span class="o">*</span> <span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mf">0.2</span><span class="p">;</span> <span class="mi">0</span><span class="p">];</span>       <span class="err">#初期値</span><span class="p">(</span><span class="err">ちょっと倒れて静止</span><span class="p">)</span>
<span class="n">n</span><span class="o">=</span><span class="mi">70</span><span class="p">;</span>                    <span class="err">#時間のきざみ数</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>     <span class="err">#時間</span><span class="mi">0</span><span class="err">～</span><span class="mi">10</span><span class="err">の等比数列</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eqn</span><span class="err">"</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span> <span class="err">#常微分方程式"</span><span class="n">eqn</span><span class="err">"を解く</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>  <span class="err">#簡易アニメーション</span>
 <span class="n">x</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>              <span class="err">#第</span><span class="mi">1</span><span class="err">変数が台車の位置</span>
 <span class="n">theta</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>          <span class="err">#第</span><span class="mi">3</span><span class="err">変数が倒れ角</span>
 <span class="nb">plot</span><span class="p">(</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">l</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span> <span class="p">);</span> <span class="err">#線分のプロット</span>
 <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="s1">'square'</span><span class="p">);</span>    <span class="err">#座標軸の設定</span>
 <span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="n">xxxxx</span><span class="p">:</span> <span class="c1">%d",i)); #タイトルの設定</span>
 <span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span>
 <span class="k">if</span> <span class="p">(</span> <span class="nb">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   <span class="err">#初回は</span><span class="mi">1</span><span class="err">秒待機</span>
 <span class="k">else</span> <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">endif</span>  <span class="err">#この数値でアニメーション速度を調整</span>
<span class="n">endfor</span>
</code></pre></div></div>

<h3 id="code-17-invpgainm">Code 17 “<a href="invpGain.m">invpGain.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">invpGain</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKp</span>
<span class="err">###</span> <span class="err">システム行列</span> <span class="p">(</span><span class="err">倒立振子</span><span class="p">)</span><span class="err">###</span>
<span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">m</span><span class="p">/</span><span class="n">M</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">)/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="n">bb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">/</span><span class="n">M</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)];</span>
<span class="err">###</span> <span class="err">可制御性行列</span> <span class="err">###</span>
<span class="n">Uc</span><span class="o">=</span><span class="p">[</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">,</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">bb</span><span class="p">];</span> <span class="err">#</span><span class="o">***</span> <span class="mi">4</span><span class="err">次元化</span> <span class="o">***</span>
<span class="err">###</span> <span class="err">行列</span><span class="n">A</span><span class="err">の固有方程式</span> <span class="err">###</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="err">#</span> <span class="n">aa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(n)*s +aa(n+1), a(1)=1</span>
<span class="n">aa</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">aa</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">);</span> <span class="err">#テキスト順</span> <span class="n">s</span><span class="o">^</span><span class="n">n</span> <span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="k">...</span><span class="c"> +aa(1)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">Wmat</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
<span class="err">###</span> <span class="err">基底変換行列</span> <span class="err">###</span>
<span class="n">Tc</span><span class="o">=</span><span class="n">Uc</span><span class="o">*</span><span class="n">W</span><span class="p">;</span>
<span class="err">###</span> <span class="err">目標の固有値と固有方程式</span> <span class="err">###</span>
<span class="n">ss</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nb">i</span><span class="p">]</span>  <span class="err">#</span><span class="o">***</span> <span class="mi">4</span><span class="err">次元化</span> <span class="o">***</span>
<span class="n">cc</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="nb">diag</span><span class="p">(</span><span class="n">ss</span><span class="p">));</span> <span class="n">cc</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">cc</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">);</span> <span class="err">#テキスト順</span>
<span class="err">###</span> <span class="err">ゲイン</span> <span class="err">###</span>
<span class="n">KKp</span><span class="o">=</span><span class="p">(</span><span class="n">cc</span><span class="o">-</span><span class="n">aa</span><span class="p">)</span><span class="o">*</span><span class="nb">inv</span><span class="p">(</span><span class="n">Tc</span><span class="p">)</span>
<span class="err">###</span> <span class="err">検算</span><span class="p">(</span><span class="err">閉ループ系の固有値</span><span class="p">)</span> <span class="err">###</span>
<span class="nb">eig</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">bb</span><span class="o">*</span><span class="n">KKp</span><span class="p">)</span>
<span class="err">###</span> <span class="err">シミュレーション</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKp</span><span class="p">;</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KKp</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">bb</span><span class="o">*</span><span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mf">0.2</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span> <span class="err">#</span><span class="o">***</span> <span class="mi">4</span><span class="err">次元化</span> <span class="o">***</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">,[</span><span class="err">"</span><span class="p">;</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x3</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x4</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">]);</span> <span class="err">#</span><span class="o">***</span> <span class="mi">4</span><span class="err">次元化</span> <span class="o">***</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">);</span><span class="nb">drawnow</span><span class="p">;</span>
<span class="nb">save</span> <span class="n">invpGain</span><span class="o">.</span><span class="n">dat</span> <span class="n">KKp</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-18-invplqrm">Code 18 “<a href="invpLQR.m">invpLQR.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">invpLQR</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKopt</span>
<span class="err">###</span> <span class="err">システム行列</span> <span class="p">(</span><span class="err">倒立振子</span><span class="p">)</span><span class="err">###</span>
<span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">m</span><span class="p">/</span><span class="n">M</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">)/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="n">bb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">/</span><span class="n">M</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)];</span>
<span class="err">###</span> <span class="err">無限時間最適レギュレータ</span> <span class="err">###</span>
<span class="n">Q</span><span class="o">=</span><span class="nb">diag</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="err">#状態</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">の重み</span>
<span class="n">R</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>                <span class="err">#入力</span><span class="n">u</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">の重み</span>
<span class="p">[</span><span class="n">KKopt</span><span class="p">,</span><span class="n">PP</span><span class="p">,</span><span class="n">EE</span><span class="p">]</span><span class="o">=</span><span class="n">lqr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">R</span><span class="p">)</span> <span class="err">#最適レギュレータを求める</span>
<span class="err">###</span> <span class="err">シミュレーション</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">KKopt</span><span class="p">;</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KKopt</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">bb</span><span class="o">*</span><span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eos</span><span class="err">"</span><span class="p">,[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mf">0.2</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">,[</span><span class="err">"</span><span class="p">;</span><span class="n">x1</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x2</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x3</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">;</span><span class="err">"</span><span class="p">;</span><span class="n">x4</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="err">"</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">Time</span><span class="err">"</span><span class="p">);</span><span class="nb">drawnow</span><span class="p">;</span>
<span class="nb">save</span> <span class="n">invpLQR</span><span class="o">.</span><span class="n">dat</span> <span class="n">KKopt</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-19-pendvec-pfm">Code 19 “<a href="pendvec-pf.m">pendvec-pf.m</a>”</h3>
<p><font color="red">※同じフォルダに，Code 2を書き込んだファイル vectorfield.m が必要． </font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pendvec</span><span class="o">-</span><span class="n">pf</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span> <span class="n">K</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">myplot</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">x0s</span><span class="p">)</span>
  <span class="n">vectorfield</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="mf">1.2</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
  <span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">XX</span><span class="o">=</span><span class="p">[];</span> <span class="n">YY</span><span class="o">=</span><span class="p">[];</span>
  <span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">columns</span><span class="p">(</span><span class="n">x0s</span><span class="p">)</span>
   <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0s</span><span class="p">(:,</span><span class="nb">i</span><span class="p">),</span><span class="n">tt</span><span class="p">);</span>
   <span class="n">XX</span><span class="o">=</span><span class="p">[</span><span class="n">XX</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)];</span> <span class="n">YY</span><span class="o">=</span><span class="p">[</span><span class="n">YY</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)];</span>
  <span class="n">endfor</span>
  <span class="nb">plot</span><span class="p">(</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">axis</span><span class="p">([</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
  <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dx</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">K</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span> <span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">;</span><span class="o">-</span><span class="mi">4</span><span class="p">];</span> <span class="n">x02</span><span class="o">=</span><span class="p">[</span><span class="mf">1.6</span><span class="p">;</span><span class="mi">3</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">K</span><span class="o">=</span><span class="mf">9.75</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span> <span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span> <span class="n">x02</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">;</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span>
<span class="nb">plot</span><span class="p">(</span><span class="mf">0.15</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">K</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span> <span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.8</span><span class="p">;</span><span class="mf">1.5</span><span class="p">];</span> <span class="n">x02</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.8</span><span class="p">;</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span>
<span class="nb">plot</span><span class="p">(</span><span class="mf">1.08</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="code-20-pendvec-snm">Code 20 “<a href="pendvec-sn.m">pendvec-sn.m</a>”</h3>
<p><font color="red">※同じフォルダに，Code 2を書き込んだファイル vectorfield.m が必要． </font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pendvec</span><span class="o">-</span><span class="n">sn</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span> <span class="n">K</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">myplot</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">x0s</span><span class="p">)</span>
  <span class="n">vectorfield</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="mf">1.2</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
  <span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
  <span class="n">XX</span><span class="o">=</span><span class="p">[];</span> <span class="n">YY</span><span class="o">=</span><span class="p">[];</span>
  <span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">columns</span><span class="p">(</span><span class="n">x0s</span><span class="p">)</span>
   <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0s</span><span class="p">(:,</span><span class="nb">i</span><span class="p">),</span><span class="n">tt</span><span class="p">);</span>
   <span class="n">XX</span><span class="o">=</span><span class="p">[</span><span class="n">XX</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)];</span> <span class="n">YY</span><span class="o">=</span><span class="p">[</span><span class="n">YY</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)];</span>
  <span class="n">endfor</span>
  <span class="nb">plot</span><span class="p">(</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">axis</span><span class="p">([</span><span class="n">rx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">rx</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
  <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">dx</span><span class="p">/</span><span class="n">dt</span><span class="err">"</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="nb">clf</span><span class="p">;</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="mf">0.9</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=</span><span class="p">[</span><span class="mf">0.53</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span> <span class="n">x02</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.58</span><span class="p">;</span><span class="o">-</span><span class="mf">0.81</span><span class="p">],[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.4</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">x02</span><span class="o">=</span><span class="p">[</span><span class="mf">0.235</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">F</span><span class="o">=-</span><span class="mf">0.9</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=-</span><span class="p">[</span><span class="mf">0.53</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span> <span class="n">x02</span><span class="o">=-</span><span class="p">[</span><span class="mf">0.5</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">plot</span><span class="p">(</span><span class="o">-</span><span class="p">[</span><span class="o">-</span><span class="mf">0.58</span><span class="p">;</span><span class="o">-</span><span class="mf">0.81</span><span class="p">],[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">F</span><span class="o">=-</span><span class="mi">2</span><span class="p">;</span> <span class="n">rx</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span><span class="n">ry</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="n">x01</span><span class="o">=-</span><span class="p">[</span><span class="o">-</span><span class="mf">1.4</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">x02</span><span class="o">=-</span><span class="p">[</span><span class="mf">0.235</span><span class="p">;</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span>
<span class="n">myplot</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,[</span><span class="n">x01</span><span class="p">,</span><span class="n">x02</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-21-pend-jumpm">Code 21 “<a href="pend-jump.m">pend-jump.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">pend</span><span class="o">-</span><span class="n">jump</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">FR</span> <span class="n">dF</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">FR</span> <span class="n">dF</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
 <span class="n">F</span> <span class="o">=</span> <span class="n">FR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">dF</span><span class="o">*</span><span class="n">t</span><span class="p">;</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">F</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">K</span><span class="o">=</span><span class="mf">9.5</span><span class="p">;</span> <span class="n">T</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">n</span><span class="o">=</span><span class="mi">120</span><span class="p">;</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span> <span class="n">FR</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">];</span> <span class="n">dF</span><span class="o">=</span><span class="p">(</span><span class="n">FR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">FR</span><span class="p">(</span><span class="mi">1</span><span class="p">))/</span><span class="n">T</span><span class="p">;</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">x1</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">);</span>
<span class="n">F1</span><span class="o">=</span><span class="n">FR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">.+</span> <span class="n">tt</span><span class="o">*</span><span class="n">dF</span><span class="p">;</span>
<span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">(</span><span class="n">n</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span> <span class="n">FR</span><span class="o">=-</span><span class="n">FR</span><span class="p">;</span> <span class="n">dF</span><span class="o">=</span><span class="p">(</span><span class="n">FR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">FR</span><span class="p">(</span><span class="mi">1</span><span class="p">))/</span><span class="n">T</span><span class="p">;</span>
<span class="n">x2</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">);</span>
<span class="n">F2</span><span class="o">=</span><span class="n">FR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">.+</span> <span class="n">tt</span><span class="o">*</span><span class="n">dF</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x1</span><span class="p">;</span><span class="n">x2</span><span class="p">];</span> <span class="n">FF</span><span class="o">=</span><span class="p">[</span><span class="n">F1</span><span class="p">,</span><span class="n">F2</span><span class="p">];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span>
  <span class="n">x</span><span class="o">=</span><span class="nb">sin</span><span class="p">(</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span> <span class="n">y</span><span class="o">=</span><span class="nb">cos</span><span class="p">(</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
  <span class="nb">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span><span class="s1">'square'</span><span class="p">);</span>
  <span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="n">F</span><span class="o">=</span><span class="c1">%f",FF(i)));  drawnow();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nb">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="k">else</span> <span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">);</span> <span class="n">endif</span>
<span class="n">endfor</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">x1</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="p">;</span><span class="n">F</span> <span class="n">increases</span> <span class="o">--&gt;</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="k">...</span>
     <span class="n">F2</span><span class="p">,</span><span class="n">x2</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="err">"</span><span class="o">--</span><span class="p">;</span><span class="n">F</span> <span class="n">decreases</span> <span class="o">&lt;--</span><span class="p">;</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">F</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="code-22-crane-hopfm">Code 22 “<a href="crane-hopf.m">crane-hopf.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">crane</span><span class="o">-</span><span class="n">hopf</span><span class="o">.</span><span class="n">m</span><span class="err">"</span> <span class="err">※旧"</span><span class="n">invp</span><span class="o">-</span><span class="n">hopf</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">M</span> <span class="n">m</span> <span class="n">l</span> <span class="n">g</span> <span class="n">KK</span><span class="p">;</span>  <span class="err">#大域変数の宣言</span>
<span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=-</span><span class="mf">9.8</span><span class="p">;</span>
<span class="n">KK</span><span class="o">=</span><span class="p">[</span><span class="mf">22.4933</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span> <span class="err">#</span><span class="n">Hopf</span><span class="err">分岐点</span>
<span class="n">KK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">0.8</span><span class="o">*</span><span class="n">KK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="err">#リミットサイクル側にちょっとずらす</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eqn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">M</span> <span class="n">m</span> <span class="n">l</span> <span class="n">g</span> <span class="n">KK</span><span class="p">;</span> <span class="err">#関数の中から大域変数を参照する宣言</span>
 <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="n">KK</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>  <span class="err">#制御入力</span>
 <span class="n">D</span><span class="o">=</span><span class="n">M</span><span class="o">*</span><span class="n">l</span> <span class="o">+</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">)/</span><span class="n">D</span> <span class="k">...</span>
         <span class="o">+</span> <span class="n">l</span><span class="p">/</span><span class="n">D</span> <span class="o">*</span> <span class="n">ut</span><span class="p">;</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span> <span class="o">-</span><span class="n">m</span><span class="o">*</span><span class="n">l</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">)/</span><span class="n">D</span> <span class="k">...</span>
         <span class="o">-</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">))/</span><span class="n">D</span> <span class="o">*</span> <span class="n">ut</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mf">0.2</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">];</span>       <span class="err">#初期値</span><span class="p">(</span><span class="err">ちょっと倒れて静止</span><span class="p">)</span>
<span class="n">n</span><span class="o">=</span><span class="mi">1500</span><span class="p">;</span>                   <span class="err">#時間のきざみ数</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>     <span class="err">#時間</span><span class="mi">0</span><span class="err">〜</span><span class="mi">10</span><span class="err">の等比数列</span>
<span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eqn</span><span class="err">"</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span> <span class="err">#常微分方程式"</span><span class="n">eqn</span><span class="err">"を解く</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="n">xx</span><span class="p">(:,</span><span class="mi">4</span><span class="p">)</span> <span class="p">);</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="nb">clf</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="n">n</span>  <span class="err">#簡易アニメーション</span> <span class="mi">5</span><span class="err">つ飛ばしで描画</span>
 <span class="n">x</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>              <span class="err">#第</span><span class="mi">1</span><span class="err">変数が台車の位置</span>
 <span class="n">theta</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>          <span class="err">#第</span><span class="mi">3</span><span class="err">変数が倒れ角</span>
 <span class="nb">plot</span><span class="p">(</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">l</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span> <span class="p">);</span> <span class="err">#線分のプロット</span>
 <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="s1">'square'</span><span class="p">);</span>    <span class="err">#座標軸の設定</span>
 <span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="err">"</span><span class="n">xxxxx</span><span class="p">:</span> <span class="c1">%d",i)); #タイトルの設定</span>
 <span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span>
 <span class="k">if</span> <span class="p">(</span> <span class="nb">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>   <span class="err">#初回は</span><span class="mi">1</span><span class="err">秒待機</span>
 <span class="k">else</span> <span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">);</span> <span class="n">endif</span>  <span class="err">#この数値でアニメーション速度を調整</span>
<span class="n">endfor</span>
</code></pre></div></div>

<h3 id="code-23-newtonm">Code 23 “<a href="newton.m">newton.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">newton</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">xx</span><span class="o">=</span><span class="n">newton</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
 <span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">;</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
 <span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)/</span><span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span>
 <span class="n">endfor</span>
<span class="n">endfunction</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">rand</span><span class="p">(</span><span class="s1">'seed'</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span>
 <span class="n">x0</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">;</span> <span class="err">#</span> <span class="o">-</span><span class="mi">5</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">5</span> <span class="err">の一様乱数</span>
 <span class="n">xx</span><span class="o">=</span><span class="n">newton</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
 <span class="nb">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="n">xx</span><span class="p">);</span>
 <span class="nb">xlabel</span><span class="p">(</span><span class="s1">'n'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'x_n'</span><span class="p">);</span>
<span class="n">endfor</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">newton</span><span class="o">.</span><span class="nb">eps</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-24-circlem">Code 24 “<a href="circle.m">circle.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="n">circle</span><span class="o">.</span><span class="n">m</span>
<span class="k">function</span> <span class="n">z</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
 <span class="n">z</span><span class="o">=</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">dx</span><span class="o">=</span><span class="mf">0.05</span><span class="p">;</span> <span class="n">dy</span><span class="o">=</span><span class="mf">0.05</span><span class="p">;</span>
<span class="n">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">y</span><span class="o">=-</span><span class="n">x</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="p">)</span>
 <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">;</span> <span class="n">y</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="p">);</span> <span class="err">#</span><span class="mi">1</span><span class="err">変数関数</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="err">にする文法</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">y</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">y</span><span class="o">&gt;-</span><span class="mf">0.8</span><span class="p">)</span>
 <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="n">dy</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">x</span><span class="p">);</span> <span class="err">#</span><span class="mi">1</span><span class="err">変数関数</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="err">にする文法</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">y</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;-</span><span class="mf">0.8</span><span class="p">)</span>
 <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">-</span><span class="n">dx</span><span class="p">;</span> <span class="n">y</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="p">);</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">y</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="err">"</span><span class="o">*</span><span class="err">"</span><span class="p">);</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">y</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="p">)</span>
 <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">+</span><span class="n">dy</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">x</span><span class="p">);</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">y</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="err">"</span><span class="o">+</span><span class="err">"</span><span class="p">);</span> <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">y</span><span class="err">"</span><span class="p">);</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">circle</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-25-bdsn-inim">Code 25 “<a href="bdsn-ini.m">bdsn-ini.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">bdsn</span><span class="o">-</span><span class="n">ini</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span> <span class="n">K</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">F</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="nb">format</span> <span class="n">long</span><span class="p">;</span> <span class="n">K</span><span class="o">=</span><span class="mf">9.5</span><span class="p">;</span> <span class="n">F0</span><span class="o">=-</span><span class="mf">0.3</span>
<span class="err">###</span> <span class="err">平衡点の概算</span> <span class="err">###</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">120</span><span class="p">);</span>
<span class="n">F</span><span class="o">=</span><span class="n">F0</span><span class="p">;</span> <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">],</span><span class="n">tt</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">));</span> <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">t</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x1</span><span class="err">"</span><span class="p">);</span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">));</span> <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">t</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x2</span><span class="err">"</span><span class="p">);</span>
<span class="nb">drawnow</span><span class="p">();</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">x0a</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="err">#最後の値</span><span class="o">=</span><span class="err">概算値</span>
<span class="err">###</span> <span class="err">初期解</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">x0</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="err">"</span><span class="n">f</span><span class="err">"</span><span class="p">,</span><span class="n">x0a</span><span class="p">)</span> <span class="err">#高精度化したもの</span>
<span class="nb">save</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">ini</span><span class="o">.</span><span class="n">dat</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F0</span> <span class="n">x0</span> <span class="n">x0a</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="code-26-bdsn-contm">Code 26 “<a href="bdsn-cont.m">bdsn-cont.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">bdsn</span><span class="o">-</span><span class="n">cont</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
<span class="nb">load</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">ini</span><span class="o">.</span><span class="n">dat</span><span class="p">;</span> <span class="err">#</span><span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">F0</span> <span class="n">x0</span> <span class="n">x00</span><span class="p">;</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
 <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
 <span class="n">y</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="err">解の接続</span> <span class="err">###</span>
<span class="n">dx</span><span class="o">=</span><span class="mf">0.03</span><span class="p">;</span> <span class="n">dF</span><span class="o">=</span><span class="mf">0.02</span><span class="p">;</span>
<span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">;</span> <span class="n">F</span><span class="o">=</span><span class="n">F0</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="n">FF</span><span class="o">=</span><span class="p">[</span><span class="n">F</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">F</span><span class="o">&lt;</span><span class="mf">0.04</span><span class="p">)</span> <span class="err">#</span><span class="mf">0.04</span><span class="err">は</span><span class="n">Code</span> <span class="mi">19</span><span class="err">のグラフのカーブより目測で</span>
 <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="o">+</span><span class="n">dF</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">),</span><span class="n">x</span><span class="p">);</span> <span class="err">#掃引方向→</span>
                  <span class="err">#</span><span class="mi">1</span><span class="err">変数関数</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="err">にする文法</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">FF</span><span class="o">=</span><span class="p">[</span><span class="n">FF</span><span class="p">,</span><span class="n">F</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="err">"</span><span class="n">ro</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="err">#掃引方向の切替点</span>
<span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">0.4</span><span class="p">)</span> <span class="err">#</span><span class="mf">0.4</span><span class="err">はこのプログラムの実行結果を見ながら調整</span>
 <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">;</span> <span class="n">F</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">),</span><span class="n">F</span><span class="p">);</span> <span class="err">#掃引方向↑</span>
                  <span class="err">#</span><span class="mi">1</span><span class="err">変数関数</span> <span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="err">にする文法</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">FF</span><span class="o">=</span><span class="p">[</span><span class="n">FF</span><span class="p">,</span><span class="n">F</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="err">"</span><span class="n">ro</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span> <span class="err">#掃引方向の切替点</span>
<span class="k">while</span> <span class="p">(</span><span class="n">F</span><span class="o">&lt;</span><span class="mf">0.3</span><span class="p">)</span> <span class="err">#</span><span class="mf">0.3</span><span class="err">は</span><span class="n">Code</span> <span class="mi">19</span><span class="err">のグラフに合わせて</span>
 <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="o">+</span><span class="n">dF</span><span class="p">;</span> <span class="n">x</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">),</span><span class="n">x</span><span class="p">);</span> <span class="err">#掃引方向→</span>
 <span class="n">xx</span><span class="o">=</span><span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">x</span><span class="p">];</span> <span class="n">FF</span><span class="o">=</span><span class="p">[</span><span class="n">FF</span><span class="p">,</span><span class="n">F</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="err">###</span> <span class="err">分岐図</span> <span class="err">###</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">FF</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="err">#分岐図</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">F</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">;</span>
<span class="nb">save</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">cont</span><span class="o">.</span><span class="n">dat</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">FF</span> <span class="n">xx</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">mono</span> <span class="o">-</span><span class="n">deps</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">cont</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-27-bdsn-stabm">Code 27 “<a href="bdsn-stab.m">bdsn-stab.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">bdsn</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
<span class="nb">load</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">cont</span><span class="o">.</span><span class="n">dat</span> <span class="err">#</span><span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">FF</span> <span class="n">xx</span>
<span class="k">function</span> <span class="n">m</span><span class="o">=</span><span class="n">Jaco</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">)</span> <span class="err">#ヤコビ行列</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span><span class="p">;</span>
 <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span> <span class="k">...</span>
      <span class="n">k</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">F</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">];</span>
<span class="n">endfunction</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">eigmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">)</span> <span class="err">#最大の固有値実部</span>
 <span class="n">y</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">real</span><span class="p">(</span><span class="nb">eig</span><span class="p">(</span><span class="n">Jaco</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">F</span><span class="p">))));</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="err">安定判別</span> <span class="err">###</span>
<span class="n">xs</span><span class="o">=</span><span class="p">[];</span> <span class="n">Fs</span><span class="o">=</span><span class="p">[];</span> <span class="n">xu</span><span class="o">=</span><span class="p">[];</span> <span class="n">Fu</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>
 <span class="n">stab</span><span class="o">=</span><span class="n">eigmax</span><span class="p">(</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">FF</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">stab</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">xs</span><span class="o">=</span><span class="p">[</span><span class="n">xs</span><span class="p">,</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">)];</span> <span class="n">Fs</span><span class="o">=</span><span class="p">[</span><span class="n">Fs</span><span class="p">,</span><span class="n">FF</span><span class="p">(</span><span class="nb">i</span><span class="p">)];</span> <span class="err">#安定平衡点</span>
 <span class="k">else</span>
  <span class="n">xu</span><span class="o">=</span><span class="p">[</span><span class="n">xu</span><span class="p">,</span><span class="n">xx</span><span class="p">(</span><span class="nb">i</span><span class="p">)];</span> <span class="n">Fu</span><span class="o">=</span><span class="p">[</span><span class="n">Fu</span><span class="p">,</span><span class="n">FF</span><span class="p">(</span><span class="nb">i</span><span class="p">)];</span> <span class="err">#不安定平衡点</span>
 <span class="n">endif</span>
<span class="n">endfor</span>
<span class="err">###</span> <span class="err">プロット用に安定平衡点を</span><span class="mi">2</span><span class="err">分割する</span> <span class="err">###</span>
<span class="n">jump</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">ns</span><span class="o">=</span><span class="nb">length</span><span class="p">(</span><span class="n">xs</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
 <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">xs</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">xs</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">)</span>
  <span class="n">jump</span><span class="o">=</span><span class="nb">i</span><span class="p">;</span>
 <span class="n">endif</span>
<span class="n">endfor</span>
<span class="n">xs1</span><span class="o">=</span><span class="n">xs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">jump</span><span class="p">);</span> <span class="n">Fs1</span><span class="o">=</span><span class="n">Fs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">jump</span><span class="p">);</span>
<span class="n">xs2</span><span class="o">=</span><span class="n">xs</span><span class="p">(</span><span class="n">jump</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">);</span> <span class="n">Fs2</span><span class="o">=</span><span class="n">Fs</span><span class="p">(</span><span class="n">jump</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ns</span><span class="p">);</span>
<span class="err">###</span> <span class="err">分岐図の描画</span> <span class="err">###</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">Fs1</span><span class="p">,</span><span class="n">xs1</span><span class="p">,</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="err">#安定</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">Fs2</span><span class="p">,</span><span class="n">xs2</span><span class="p">,</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="err">#安定</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">Fu</span><span class="p">,</span><span class="n">xu</span><span class="p">,</span><span class="err">"</span><span class="o">.</span><span class="mi">1</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>  <span class="err">#不安定</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">F</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="err">"</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">;</span>
<span class="nb">save</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="n">dat</span> <span class="n">c</span> <span class="n">k</span> <span class="n">K</span> <span class="n">Fs1</span> <span class="n">xs1</span> <span class="n">Fs2</span> <span class="n">xs2</span><span class="p">;</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">bdsn</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-28-crane-hopfbdm">Code 28 “<a href="crane-hopfbd.m">crane-hopfbd.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">crane</span><span class="o">-</span><span class="n">hopfbd</span><span class="o">.</span><span class="n">m</span><span class="err">"</span> <span class="err">※旧"</span><span class="n">invp</span><span class="o">-</span><span class="n">hopfbd</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">K3</span> <span class="n">K4</span><span class="p">;</span>
<span class="n">K3</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span> <span class="n">K4</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="err">#台車制御のゲイン</span><span class="p">(</span><span class="err">固定</span><span class="p">)</span>
<span class="n">M</span><span class="o">=</span><span class="mi">2</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">/</span><span class="mi">3</span><span class="p">;</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">g</span><span class="o">=-</span><span class="mf">9.8</span><span class="p">;</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">m</span><span class="p">/</span><span class="n">M</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">)/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="n">bb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">/</span><span class="n">M</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">/(</span><span class="n">M</span><span class="o">*</span><span class="n">l</span><span class="p">)];</span>
<span class="err">###</span> <span class="err">閉ループ系の行列</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">m</span><span class="o">=</span><span class="n">H</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">A</span> <span class="n">bb</span> <span class="n">K3</span> <span class="n">K4</span><span class="p">;</span>
 <span class="n">KK</span><span class="o">=</span><span class="p">[</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">,</span><span class="n">K3</span><span class="p">,</span><span class="n">K4</span><span class="p">];</span>
 <span class="n">m</span><span class="o">=</span><span class="n">A</span><span class="o">-</span><span class="n">bb</span><span class="o">*</span><span class="n">KK</span><span class="p">;</span> <span class="err">#</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="err">分岐方程式</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">bifeqn</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">)</span>
 <span class="n">m</span><span class="o">=</span><span class="n">H</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">);</span> <span class="err">#閉ループ系</span>
 <span class="n">aa</span><span class="o">=</span><span class="nb">poly</span><span class="p">(</span><span class="n">m</span><span class="p">)(</span><span class="mi">2</span><span class="p">:</span><span class="n">rows</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
 <span class="n">y</span><span class="o">=</span><span class="n">aa</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">aa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">aa</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">aa</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">aa</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">aa</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="err">###</span> <span class="n">Hopf</span><span class="err">分岐点の概算</span> <span class="err">###</span>
<span class="n">K2</span><span class="o">=</span><span class="mi">7</span><span class="p">;</span> <span class="n">KK1</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span> <span class="err">#</span><span class="n">invp</span><span class="o">-</span><span class="n">hopf</span><span class="o">.</span><span class="n">m</span><span class="err">を参考に</span>
<span class="n">yy</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span>
 <span class="n">yy</span><span class="o">=</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">bifeqn</span><span class="p">(</span><span class="n">KK1</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">K2</span><span class="p">)];</span>
<span class="n">endfor</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">KK1</span><span class="p">,</span><span class="n">yy</span><span class="p">);</span> <span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">K1</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">bifeqn</span><span class="err">"</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="err">#グラフを見ると</span><span class="mf">22.5</span><span class="err">付近で</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span>
<span class="err">###</span> <span class="err">初期解</span> <span class="err">###</span>
<span class="nb">format</span> <span class="n">long</span><span class="p">;</span>
<span class="n">K1</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="n">bifeqn</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">),</span><span class="mf">22.5</span><span class="p">)</span> <span class="err">#概算より</span>
          <span class="err">#</span><span class="mi">1</span><span class="err">変数関数</span> <span class="n">bifeqn</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="err">にする文法</span>
<span class="n">BF1</span><span class="o">=</span><span class="p">[</span><span class="n">K1</span><span class="p">];</span> <span class="n">BF2</span><span class="o">=</span><span class="p">[</span><span class="n">K2</span><span class="p">];</span>
<span class="err">###</span> <span class="err">接続</span><span class="mi">1</span> <span class="err">###</span>
<span class="n">dK</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">K2</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">)</span>
 <span class="n">K2</span><span class="o">=</span><span class="n">K2</span><span class="o">+</span><span class="n">dK</span><span class="p">;</span> <span class="n">K1</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="n">bifeqn</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">),</span><span class="n">K1</span><span class="p">);</span>
 <span class="n">BF1</span><span class="o">=</span><span class="p">[</span><span class="n">BF1</span><span class="p">,</span><span class="n">K1</span><span class="p">];</span> <span class="n">BF2</span><span class="o">=</span><span class="p">[</span><span class="n">BF2</span><span class="p">,</span><span class="n">K2</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="err">###</span> <span class="err">接続</span><span class="mi">2</span> <span class="err">###</span>
<span class="n">K1</span><span class="o">=</span><span class="n">BF1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">K2</span><span class="o">=</span><span class="n">BF2</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">BF1</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">BF1</span><span class="p">);</span> <span class="n">BF2</span><span class="o">=</span><span class="nb">fliplr</span><span class="p">(</span><span class="n">BF2</span><span class="p">);</span> <span class="err">#接続</span><span class="mi">1</span><span class="err">とグラフを継げたいので，逆順に</span>
<span class="k">while</span> <span class="p">(</span><span class="n">K1</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">)</span>
 <span class="n">K1</span><span class="o">=</span><span class="n">K1</span><span class="o">+</span><span class="n">dK</span><span class="p">;</span> <span class="n">K2</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">K2</span><span class="p">)</span> <span class="n">bifeqn</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">K2</span><span class="p">),</span><span class="n">K2</span><span class="p">);</span>
 <span class="n">BF1</span><span class="o">=</span><span class="p">[</span><span class="n">BF1</span><span class="p">,</span><span class="n">K1</span><span class="p">];</span> <span class="n">BF2</span><span class="o">=</span><span class="p">[</span><span class="n">BF2</span><span class="p">,</span><span class="n">K2</span><span class="p">];</span>
<span class="n">endwhile</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">BF1</span><span class="p">,</span><span class="n">BF2</span><span class="p">,</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">30</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">K1</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">K2</span><span class="err">"</span><span class="p">);</span>
<span class="err">###</span> <span class="err">固有値の確認</span> <span class="err">###</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">format</span> <span class="n">short</span><span class="p">;</span>
<span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="n">BF1</span><span class="p">(</span><span class="mi">170</span><span class="p">),</span><span class="n">BF2</span><span class="p">(</span><span class="mi">170</span><span class="p">)];</span> <span class="err">#分岐点の</span><span class="mi">1</span><span class="err">つ</span>
<span class="n">ps</span><span class="o">=</span><span class="n">p0</span><span class="o">+</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span> <span class="n">pu</span><span class="o">=</span><span class="n">p0</span><span class="o">-</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ps</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">*</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">p0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">p0</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">ko</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">pu</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pu</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">+</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="err">"</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="n">Stable_eigenvalue</span><span class="o">=</span><span class="nb">eig</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ps</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">printf</span><span class="p">(</span><span class="err">"</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="n">Imaginary_eigenvalue</span><span class="o">=</span><span class="nb">eig</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">p0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">p0</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">printf</span><span class="p">(</span><span class="err">"</span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="n">Unstable_eigenvalue</span><span class="o">=</span><span class="nb">eig</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">pu</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pu</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">invp</span><span class="o">-</span><span class="n">hopfbd</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<hr />
<p>以下，Octave の開発環境に含まれるコマンド mkoctfile を使う．</p>

<p>参考： http://www.kkaneko.com/rinkou/octave/octavemex.html</p>

<p>※例えば，Ubuntuでは「octave3.0-headers」みたいなパッケージを追加インストールすると使用できる．</p>

<h3 id="code-29-fpen_pocc">Code 29 “<a href="fpen_po.cc">fpen_po.cc</a>”</h3>

<p>Octave の開発環境で，Linux の場合，</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; mkoctfile fpen_po.cc
</code></pre></div></div>

<p>として fpen_po.oct を作っておく．後述のプログラムで使う．※ 単独では使えない．</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* "fpen_po.cc"
 *
 * [...]$ mkoctfile fpen_po.cc
 *
 * として fpen_po.oct に変換する．
 */</span>
<span class="cp">#include &lt;octave/oct.h&gt;
#include &lt;octave/LSODE.h&gt;
</span>
<span class="cm">/* 運動方程式
 * ※ octave でベクトルの第1成分は x(1) だが，ここでは x(0)
 * --- ここから --- */</span>
<span class="k">struct</span> <span class="n">_p</span> <span class="p">{</span> <span class="kt">double</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">omeg</span><span class="p">;</span> <span class="p">}</span> <span class="n">p</span><span class="p">;</span>
<span class="n">ColumnVector</span> <span class="nf">xdot</span><span class="p">(</span><span class="k">const</span> <span class="n">ColumnVector</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ColumnVector</span> <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* octave では dx(1)=x(2) */</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">P</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">omeg</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dx</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* --- ここまで --- */</span>

<span class="n">DEFUN_DLD</span> <span class="p">(</span><span class="n">fpen_po</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">,</span> <span class="s">"Poincare map for a single pendlumn"</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* 引数の取得 */</span>
  <span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x0</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">vector_value</span> <span class="p">());</span> <span class="c1">//初期値</span>
  <span class="kt">double</span> <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">double_value</span> <span class="p">());</span> <span class="c1">//周期</span>
  <span class="kt">double</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//無視する過渡の点数</span>
  <span class="kt">double</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//出力点数</span>
  <span class="cm">/* global 変数の取得 */</span>
  <span class="n">p</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"c"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"k"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"P"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">omeg</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"omeg"</span> <span class="p">);</span>
  <span class="cm">/* 数値積分 */</span>
  <span class="kt">int</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">x0</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="c1">//次元</span>
  <span class="kt">int</span> <span class="n">Tn</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="c1">//分割数</span>
  <span class="kt">double</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">Tn</span><span class="p">;</span>
  <span class="n">ODEFunc</span> <span class="n">odef</span><span class="p">(</span><span class="n">xdot</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">;</span> <span class="c1">//解</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* 過渡を無視する */</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">Matrix</span> <span class="n">pm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dim</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">pm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">pm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">octave_value</span> <span class="p">(</span><span class="n">pm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">retval</span> <span class="o">=</span> <span class="mf">0.123456789012345</span><span class="p">;</span>
  <span class="n">octave_value</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">get_global_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_defined</span> <span class="p">()</span> <span class="o">||</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">octave_stdout</span><span class="o">&lt;&lt;</span> <span class="s">"Global variable </span><span class="se">\"</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\"</span><span class="s"> is empty"</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">double_value</span> <span class="p">();</span>
  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="code-30-fpen-trajm">Code 30 “<a href="fpen-traj.m">fpen-traj.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpend</span><span class="o">-</span><span class="n">traj</span><span class="o">.</span><span class="n">m</span><span class="err">"</span> <span class="err">※環境によっては実行時間がかかる！</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
<span class="k">function</span> <span class="n">dx</span><span class="o">=</span><span class="n">eom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
 <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">omeg</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
<span class="n">endfunction</span>
<span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">tn</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">dn</span><span class="o">=</span><span class="n">tn</span><span class="o">+</span><span class="mi">500</span><span class="p">;</span> <span class="err">#取得するデータ長</span>
<span class="n">tt</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dn</span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="mi">50</span><span class="o">*</span><span class="n">dn</span><span class="p">);</span>
<span class="err">###</span> <span class="mi">1</span><span class="err">周期</span> <span class="err">###</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">)(</span><span class="n">tn</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">dn</span><span class="p">,:);</span> <span class="err">#過渡を削除</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}(t)}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">fpen</span><span class="o">-</span><span class="n">traj1</span><span class="o">.</span><span class="nb">eps</span>
<span class="err">###</span> <span class="mi">2</span><span class="err">周期</span> <span class="err">###</span>
<span class="n">x0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span> <span class="err">#分岐図と履歴を合わせるため</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.65</span><span class="p">;</span> <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">)(</span><span class="n">tn</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">dn</span><span class="p">,:);</span> <span class="err">#過渡を削除</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}(t)}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">fpen</span><span class="o">-</span><span class="n">traj2</span><span class="o">.</span><span class="nb">eps</span>
<span class="err">###</span> <span class="mi">4</span><span class="err">周期</span> <span class="err">###</span>
<span class="n">x0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span> <span class="err">#分岐図と履歴を合わせるため</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.63</span><span class="p">;</span> <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">)(</span><span class="n">tn</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">dn</span><span class="p">,:);</span> <span class="err">#過渡を削除</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">151</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">151</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">o</span><span class="err">"</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}(t)}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">fpen</span><span class="o">-</span><span class="n">traj4</span><span class="o">.</span><span class="nb">eps</span>
<span class="err">###</span> <span class="err">無限周期</span> <span class="err">###</span>
<span class="n">x0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span> <span class="err">#分岐図と履歴を合わせるため</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.61</span><span class="p">;</span> <span class="n">xx</span><span class="o">=</span><span class="n">lsode</span><span class="p">(</span><span class="err">"</span><span class="n">eom</span><span class="err">"</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">tt</span><span class="p">)(</span><span class="n">tn</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">dn</span><span class="p">,:);</span> <span class="err">#過渡を削除</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}(t)}'</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">fpen</span><span class="o">-</span><span class="n">trajx</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-31-fpen-bdm">Code 31 “<a href="fpen-bd.m">fpen-bd.m</a>”</h3>
<p><font color="red">※同じフォルダに，上で作った fpen_po.oct が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">bd</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.22</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
<span class="n">n1</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">500</span><span class="p">;</span>  <span class="err">#データ数</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
<span class="n">p</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="n">fpen_bd</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
 <span class="n">c</span><span class="o">=</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span>
 <span class="n">xx</span><span class="o">=</span><span class="n">fpen_po</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span> <span class="err">#</span><span class="n">fpen_po</span><span class="o">.</span><span class="n">oct</span> <span class="err">によるポアンカレ写像の計算</span>
 <span class="nb">graph</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)];</span>
 <span class="nb">plot</span><span class="p">(</span><span class="nb">graph</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="nb">graph</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
 <span class="n">fpen_bd</span><span class="o">=</span><span class="p">[</span><span class="n">fpen_bd</span><span class="p">;</span><span class="nb">graph</span><span class="p">];</span>
 <span class="n">x0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="n">n2</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span>
<span class="n">endfor</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'fontsize'</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'x_n'</span><span class="p">,</span> <span class="s1">'fontsize'</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">save</span> <span class="n">fpen</span><span class="o">-</span><span class="n">bd</span><span class="o">.</span><span class="n">dat</span> <span class="n">fpen_bd</span><span class="p">;</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">fpen</span><span class="o">-</span><span class="n">bd</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-32-fpen-poincarem">Code 32 “<a href="fpen-poincare.m">fpen-poincare.m</a>”</h3>
<p><font color="red">※同じフォルダに，上で作った fpen_po.oct が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">poincare</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
<span class="n">n1</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">4000</span><span class="p">;</span> <span class="err">#データ数</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.61</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
<span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span> <span class="err">#外力の周期</span>
<span class="n">xx</span><span class="o">=</span><span class="n">fpen_po</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span> <span class="err">#ポアンカレ写像</span>
<span class="n">x</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.+</span><span class="nb">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">)</span><span class="o">.-</span><span class="nb">pi</span><span class="p">;</span> <span class="err">#角度を</span><span class="o">-</span><span class="err">πからπに収める変換</span>
<span class="n">y</span><span class="o">=</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="nb">pi</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="o">-</span><span class="mf">0.71</span><span class="p">,</span><span class="mf">3.22</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'x_n mod {2\pi}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}_n}'</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">fpen</span><span class="o">-</span><span class="n">poincare1</span><span class="o">.</span><span class="nb">eps</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.3</span><span class="p">;</span>
<span class="n">xx</span><span class="o">=</span><span class="n">fpen_po</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span> <span class="err">#ポアンカレ写像</span>
<span class="n">x</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.+</span><span class="nb">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">)</span><span class="o">.-</span><span class="nb">pi</span><span class="p">;</span> <span class="err">#角度を</span><span class="o">-</span><span class="err">πからπに収める変換</span>
<span class="n">y</span><span class="o">=</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span> <span class="nb">axis</span><span class="p">([</span><span class="o">-</span><span class="nb">pi</span><span class="p">,</span><span class="nb">pi</span><span class="p">,</span><span class="o">-</span><span class="mf">0.71</span><span class="p">,</span><span class="mf">3.22</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'x_n mod {2\pi}'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'{~x{.5.}_n}'</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">fpen</span><span class="o">-</span><span class="n">poincare2</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-33-fpen_polincc">Code 33 “<a href="fpen_polin.cc">fpen_polin.cc</a>”</h3>
<p>Octave の開発環境で，Linux の場合，</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; mkoctfile fpen_polin.cc
</code></pre></div></div>

<p>として fpen_polin.oct を作っておく．後述のプログラムで使う．※ 単独では使えない．</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* "fpen_polin.cc"
 *
 * [...]$ mkoctfile fpen_polin.cc
 *
 * として fpen_polin.oct に変換する．
 */</span>
<span class="cp">#include &lt;octave/oct.h&gt;
#include &lt;octave/LSODE.h&gt;
</span>
<span class="cm">/* 運動方程式
 * ※ octave でベクトルの第1成分は x(1) だが，ここでは x(0)
 * --- ここから --- */</span>
<span class="k">struct</span> <span class="n">_p</span> <span class="p">{</span> <span class="kt">double</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">omeg</span><span class="p">;</span> <span class="p">}</span> <span class="n">p</span><span class="p">;</span>
<span class="n">ColumnVector</span> <span class="nf">xdot</span><span class="p">(</span><span class="k">const</span> <span class="n">ColumnVector</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ColumnVector</span> <span class="n">dx</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* octave では dx(1)=x(2) */</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">P</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">omeg</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="cm">/* octave では dx(3)=x(4) */</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">;</span>
  <span class="k">return</span> <span class="n">dx</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* --- ここまで --- */</span>
<span class="cm">/* ※ 以下は"fpen_po.cc"と共通 */</span>

<span class="n">DEFUN_DLD</span> <span class="p">(</span><span class="n">fpen_polin</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">,</span> <span class="s">"Poincare map for a single pendlumn"</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* 引数の取得 */</span>
  <span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x0</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">vector_value</span> <span class="p">());</span> <span class="c1">//初期値</span>
  <span class="kt">double</span> <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">double_value</span> <span class="p">());</span> <span class="c1">//周期</span>
  <span class="kt">double</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//無視する過渡の点数</span>
  <span class="kt">double</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//出力点数</span>
  <span class="cm">/* global 変数の取得 */</span>
  <span class="n">p</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"c"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"k"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"P"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">omeg</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"omeg"</span> <span class="p">);</span>
  <span class="cm">/* 数値積分 */</span>
  <span class="kt">int</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">x0</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="c1">//次元</span>
  <span class="kt">int</span> <span class="n">Tn</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="c1">//分割数</span>
  <span class="kt">double</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">Tn</span><span class="p">;</span>
  <span class="n">ODEFunc</span> <span class="n">odef</span><span class="p">(</span><span class="n">xdot</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">;</span> <span class="c1">//解</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* 過渡を無視する */</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">Matrix</span> <span class="n">pm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dim</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">pm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">pm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">octave_value</span> <span class="p">(</span><span class="n">pm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">retval</span> <span class="o">=</span> <span class="mf">0.123456789012345</span><span class="p">;</span>
  <span class="n">octave_value</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">get_global_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_defined</span> <span class="p">()</span> <span class="o">||</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">octave_stdout</span><span class="o">&lt;&lt;</span> <span class="s">"Global variable </span><span class="se">\"</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\"</span><span class="s"> is empty"</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">double_value</span> <span class="p">();</span>
  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="code-34-fpen-stabm">Code 34 “<a href="fpen-stab.m">fpen-stab.m</a>”</h3>
<p><font color="red">※同じフォルダに，上で作った fpen_polin.oct が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span> <span class="n">T</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.7</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
<span class="n">n1</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">4000</span><span class="p">;</span> <span class="err">#データ数</span>
<span class="err">###</span> <span class="err">不動点の概算</span> <span class="err">###</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span> <span class="err">#外力の周期</span>
<span class="n">xx</span><span class="o">=</span><span class="n">fpen_po</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span> <span class="err">#ポアンカレ写像</span>
<span class="n">p0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="n">n2</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span> <span class="err">#概算値</span>
<span class="err">###</span> <span class="err">不動点の方程式</span> <span class="err">###</span>
<span class="k">function</span> <span class="n">y</span><span class="o">=</span><span class="n">fixp</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
 <span class="k">global</span> <span class="n">T</span><span class="p">;</span>
 <span class="n">p1</span><span class="o">=</span><span class="n">fpen_po</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)(</span><span class="mi">2</span><span class="p">,:)</span><span class="o">'</span><span class="p">;</span>
 <span class="n">y</span><span class="o">=</span><span class="n">p0</span><span class="o">-</span><span class="n">p1</span><span class="p">;</span>
<span class="n">endfunction</span>
<span class="n">p</span><span class="o">=</span><span class="n">p0</span><span class="p">;</span> <span class="n">nc</span><span class="o">=</span><span class="mi">200</span><span class="p">;</span> <span class="n">cc</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="n">nc</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">fpen_stab</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nc</span><span class="o">+</span><span class="mi">1</span>
 <span class="n">c</span><span class="o">=</span><span class="n">cc</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
 <span class="n">p</span><span class="o">=</span><span class="n">fsolve</span><span class="p">(</span><span class="err">"</span><span class="n">fixp</span><span class="err">"</span><span class="p">,</span><span class="n">p</span><span class="p">);</span> <span class="err">###</span> <span class="err">ニュートン法による不動点</span> <span class="err">###</span>
 <span class="n">R0</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span> <span class="n">R1</span><span class="o">=</span><span class="n">fpen_polin</span><span class="p">(</span><span class="n">R0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
 <span class="n">R0</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span> <span class="n">R2</span><span class="o">=</span><span class="n">fpen_polin</span><span class="p">(</span><span class="n">R0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">'</span><span class="p">;</span>
 <span class="n">R</span><span class="o">=</span><span class="p">[</span><span class="n">R1</span><span class="p">,</span><span class="n">R2</span><span class="p">];</span> <span class="n">eigenvalue</span><span class="o">=</span><span class="nb">eig</span><span class="p">(</span><span class="n">R</span><span class="p">);</span> <span class="n">mae</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eigenvalue</span><span class="p">));</span>
 <span class="k">if</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">0.7</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">1e-6</span><span class="p">)</span> <span class="n">eig070</span><span class="o">=</span><span class="n">eigenvalue</span> <span class="n">endif</span>
 <span class="k">if</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">0.65</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">)</span> <span class="n">eig065</span><span class="o">=</span><span class="n">eigenvalue</span><span class="p">;</span> <span class="n">endif</span>
 <span class="n">fpen_stab</span><span class="o">=</span><span class="p">[</span><span class="n">fpen_stab</span><span class="p">;</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">mae</span><span class="p">];</span>
<span class="n">endfor</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">fpen_stab</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">fpen_stab</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="nb">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">c</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">Largest</span> <span class="o">|</span><span class="n">s_i</span><span class="o">|</span><span class="err">"</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="mf">0.64</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">]);</span><span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">save</span> <span class="n">fpen</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="n">dat</span> <span class="n">fpen_stab</span> <span class="n">eig070</span> <span class="n">eig065</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">20</span> <span class="n">fpen</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-35-fpen-stabpfm">Code 35 “<a href="fpen-stabpf.m">fpen-stabpf.m</a>”</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">stabpf</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="nb">load</span> <span class="n">fpen</span><span class="o">-</span><span class="n">bd</span><span class="o">.</span><span class="n">dat</span> <span class="err">#</span><span class="n">fpen_bd</span><span class="p">;</span> <span class="err">分岐図</span>
<span class="nb">load</span> <span class="n">fpen</span><span class="o">-</span><span class="n">stab</span><span class="o">.</span><span class="n">dat</span> <span class="err">#</span><span class="n">fpen_stab</span> <span class="n">eig070</span> <span class="n">eig065</span><span class="p">;</span> <span class="err">安定判別</span>
<span class="n">eig070</span>
<span class="n">eig065</span>
<span class="err">###</span> <span class="err">安定性で分割</span> <span class="err">###</span>
<span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">mae</span><span class="o">=</span><span class="n">fpen_stab</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">ps</span><span class="o">=</span><span class="p">[];</span> <span class="n">pu</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">rows</span><span class="p">(</span><span class="n">fpen_stab</span><span class="p">);</span>
 <span class="n">mae</span><span class="o">=</span><span class="n">fpen_stab</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">mae</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">ps</span><span class="o">=</span><span class="p">[</span><span class="n">ps</span><span class="p">;</span><span class="n">fpen_stab</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)];</span> <span class="err">#安定</span>
 <span class="k">else</span>
  <span class="n">pu</span><span class="o">=</span><span class="p">[</span><span class="n">pu</span><span class="p">;</span><span class="n">fpen_stab</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)];</span> <span class="err">#不安定</span>
 <span class="n">endif</span>
<span class="n">endfor</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="n">pu2</span><span class="o">=</span><span class="n">pu</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">rows</span><span class="p">(</span><span class="n">pu</span><span class="p">),:);</span> <span class="err">#表示を粗く</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">ps</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">ps</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span> <span class="s1">'linewidth'</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">pu2</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">pu2</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="n">ko</span><span class="err">"</span><span class="p">,</span> <span class="s1">'markersize'</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">fpen_bd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">fpen_bd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span>
<span class="nb">axis</span><span class="p">([</span><span class="mf">0.61</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="o">-</span><span class="mf">7.9</span><span class="p">,</span><span class="o">-</span><span class="mf">6.5</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">c</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">p_n</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">20</span> <span class="n">fpen</span><span class="o">-</span><span class="n">stabpf</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-36-fpen_lyapcc">Code 36 “<a href="fpen_lyap.cc">fpen_lyap.cc</a>”</h3>
<p>Octave の開発環境で，Linux の場合，</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; mkoctfile fpen_lyap.cc
</code></pre></div></div>

<p>として fpen_lyap.oct を作っておく．後述のプログラムで使う．</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* "fpen_lyap.cc"
 *
 * [...]$ mkoctfile fpen_lyap.cc
 *
 * として fpen_lyap.oct に変換する．
 */</span>
<span class="cp">#include &lt;octave/oct.h&gt;
#include &lt;octave/LSODE.h&gt;
</span>
<span class="cm">/* 運動方程式
 * ※ octave でベクトルの第1成分は x(1) だが，ここでは x(0)
 * --- ここから --- */</span>
<span class="k">struct</span> <span class="n">_p</span> <span class="p">{</span> <span class="kt">double</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">omeg</span><span class="p">;</span> <span class="p">}</span> <span class="n">p</span><span class="p">;</span>
<span class="n">ColumnVector</span> <span class="nf">xdot</span><span class="p">(</span><span class="k">const</span> <span class="n">ColumnVector</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ColumnVector</span> <span class="n">dx</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* octave では dx(1)=x(2) */</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">P</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">omeg</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="cm">/* octave では dx(3)=x(4) */</span>
  <span class="n">dx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">k</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">;</span>
  <span class="k">return</span> <span class="n">dx</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* --- ここまで --- */</span>

<span class="kt">double</span> <span class="nf">norm2</span><span class="p">(</span><span class="n">ColumnVector</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">dim</span><span class="o">=</span><span class="n">x</span><span class="p">.</span><span class="n">rows</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">dim</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">dim</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">r</span> <span class="o">+=</span> <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">ColumnVector</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">dim</span><span class="o">=</span><span class="n">x</span><span class="p">.</span><span class="n">rows</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">dim</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">dim</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/=</span><span class="n">r</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">DEFUN_DLD</span> <span class="p">(</span><span class="n">fpen_lyap</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">,</span> <span class="s">"Poincare map for a single pendlumn"</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* 引数の取得 */</span>
  <span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x0</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">vector_value</span> <span class="p">());</span> <span class="c1">//初期値</span>
  <span class="kt">double</span> <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">double_value</span> <span class="p">());</span> <span class="c1">//周期</span>
  <span class="kt">double</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//無視する過渡の点数</span>
  <span class="kt">double</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">int_value</span> <span class="p">());</span> <span class="c1">//出力点数</span>
  <span class="cm">/* global 変数の取得 */</span>
  <span class="n">p</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"c"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"k"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"P"</span> <span class="p">);</span>
  <span class="n">p</span><span class="p">.</span><span class="n">omeg</span> <span class="o">=</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="s">"omeg"</span> <span class="p">);</span>
  <span class="cm">/* 数値積分 */</span>
  <span class="kt">int</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">x0</span><span class="p">.</span><span class="n">rows</span><span class="p">();</span> <span class="c1">//次元</span>
  <span class="kt">int</span> <span class="n">Tn</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="c1">//分割数</span>
  <span class="kt">double</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">Tn</span><span class="p">;</span>
  <span class="n">ODEFunc</span> <span class="n">odef</span><span class="p">(</span><span class="n">xdot</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">x</span><span class="o">=</span><span class="n">x0</span><span class="p">;</span> <span class="c1">//解</span>
  <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="n">norm2</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* 過渡を無視する */</span>
    <span class="n">normalize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">);</span> <span class="cm">/* 長さを1に */</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">norm2</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Matrix</span> <span class="n">pm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dim</span><span class="p">);</span>
  <span class="n">ColumnVector</span> <span class="n">lam</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">pm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">normalize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">);</span> <span class="cm">/* 長さを1に */</span>
    <span class="n">LSODE</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">odef</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">ti</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">ti</span><span class="o">&lt;=</span><span class="n">Tn</span><span class="p">;</span> <span class="n">ti</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ti</span><span class="p">;</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">ls</span><span class="p">.</span><span class="n">do_integrate</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">norm2</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">lam</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">dim</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">pm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">octave_value_list</span> <span class="n">retval</span><span class="p">;</span>
  <span class="n">retval</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">octave_value</span><span class="p">(</span><span class="n">lam</span><span class="p">);</span>
  <span class="n">retval</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">octave_value</span><span class="p">(</span><span class="n">pm</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">get_global_double</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">retval</span> <span class="o">=</span> <span class="mf">0.123456789012345</span><span class="p">;</span>
  <span class="n">octave_value</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">get_global_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_defined</span> <span class="p">()</span> <span class="o">||</span> <span class="n">tmp</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">octave_stdout</span><span class="o">&lt;&lt;</span> <span class="s">"Global variable </span><span class="se">\"</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\"</span><span class="s"> is empty"</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">double_value</span> <span class="p">();</span>
  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="code-37-fpen-lyapm">Code 37 “<a href="fpen-lyap.m">fpen-lyap.m</a>”</h3>
<p><font color="red">※同じフォルダに，上で作った fpen_lyap.oct が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">lyap</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.3</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span>
<span class="n">n1</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">2000</span><span class="p">;</span>  <span class="err">#データ数</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
<span class="err">###</span> <span class="err">カオスのリアプノフ指数</span> <span class="err">###</span>
<span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">lam</span><span class="p">]</span><span class="o">=</span><span class="n">fpen_lyap</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span>
<span class="n">lyap</span><span class="o">=</span><span class="nb">mean</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">.+</span><span class="nb">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">)</span><span class="o">.-</span><span class="nb">pi</span><span class="p">;</span> <span class="err">#角度を</span><span class="o">-</span><span class="err">πからπに収める変換</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xx</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span><span class="s1">'.;{/Symbol l_k};'</span><span class="p">);</span> <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">lyap</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">lam</span><span class="p">)),</span><span class="s1">'-;{/Symbol l};'</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="err">"</span><span class="n">k</span><span class="err">"</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="err">"</span><span class="n">Lyapunov</span> <span class="n">exponent</span><span class="err">"</span><span class="p">);</span>
<span class="nb">drawnow</span><span class="p">();</span> <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">24</span> <span class="n">fpen</span><span class="o">-</span><span class="n">lyap</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

<h3 id="code-38-fpen-lyapbdm">Code 38 “<a href="fpen-lyapbd.m">fpen-lyapbd.m</a>”</h3>
<p><font color="red">※同じフォルダに，上で作った fpen_lyap.oct が必要．</font></p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="err">"</span><span class="n">fpen</span><span class="o">-</span><span class="n">lyapbd</span><span class="o">.</span><span class="n">m</span><span class="err">"</span>
<span class="k">global</span> <span class="n">c</span> <span class="n">k</span> <span class="n">P</span> <span class="n">omeg</span><span class="p">;</span>
<span class="n">c</span><span class="o">=</span><span class="mf">0.3</span><span class="p">;</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">P</span><span class="o">=</span><span class="mf">2.7</span><span class="p">;</span> <span class="n">omeg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="p">/</span><span class="n">omeg</span><span class="p">;</span>
<span class="n">n1</span><span class="o">=</span><span class="mi">800</span><span class="p">;</span> <span class="err">#無視する過渡応答</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">800</span><span class="p">;</span>  <span class="err">#データ数</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
<span class="err">###</span> <span class="err">周期倍加分岐のリアプノフ指数</span> <span class="err">###</span>
<span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span> <span class="n">p</span><span class="o">=</span><span class="nb">linspace</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">hold</span> <span class="n">on</span><span class="p">;</span> <span class="n">lyapbd</span><span class="o">=</span><span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span>
 <span class="n">c</span><span class="o">=</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span> <span class="p">[</span><span class="n">xx</span><span class="p">,</span><span class="n">lam</span><span class="p">]</span><span class="o">=</span><span class="n">fpen_lyap</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">);</span>
 <span class="n">lyap</span><span class="o">=</span><span class="nb">mean</span><span class="p">(</span><span class="n">lam</span><span class="p">);</span> <span class="nb">graph</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="n">lyap</span><span class="p">];</span>
 <span class="nb">plot</span><span class="p">(</span><span class="nb">graph</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="nb">graph</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="o">.</span><span class="err">"</span><span class="p">);</span> <span class="nb">drawnow</span><span class="p">();</span>
 <span class="n">lyapbd</span><span class="o">=</span><span class="p">[</span><span class="n">lyapbd</span><span class="p">;</span><span class="nb">graph</span><span class="p">];</span>
 <span class="n">x0</span><span class="o">=</span><span class="n">xx</span><span class="p">(</span><span class="n">rows</span><span class="p">(</span><span class="n">xx</span><span class="p">),:)</span><span class="o">'</span><span class="p">;</span>
<span class="n">endfor</span>
<span class="nb">hold</span> <span class="n">off</span><span class="p">;</span> <span class="nb">plot</span><span class="p">(</span><span class="n">lyapbd</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">lyapbd</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="err">"</span><span class="n">k</span><span class="o">-</span><span class="err">"</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'fontsize'</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s1">'Lyapunov exponent'</span><span class="p">,</span> <span class="s1">'fontsize'</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span> <span class="nb">drawnow</span><span class="p">();</span>
<span class="nb">save</span> <span class="n">fpen</span><span class="o">-</span><span class="n">lyapbd</span><span class="o">.</span><span class="n">dat</span> <span class="n">lyapbd</span><span class="p">;</span>
<span class="err">#</span><span class="nb">print</span> <span class="o">-</span><span class="n">deps2</span> <span class="o">-</span><span class="n">F</span><span class="p">:</span><span class="mi">26</span> <span class="n">fpen</span><span class="o">-</span><span class="n">lyapbd</span><span class="o">.</span><span class="nb">eps</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>


    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="検索キーワードを入力してください..." />
    <div id="results" class="results"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>フォロー</strong></li>
    
    
    
    
    
    
    <li><a href="http://edu.katzlab.jp/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 吉田勝俊. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://edu.katzlab.jp/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>




<script src="http://edu.katzlab.jp/assets/js/lunr/lunr.min.js"></script>
<script src="http://edu.katzlab.jp/assets/js/lunr/lunr-store.js"></script>
<script src="http://edu.katzlab.jp/assets/js/lunr/lunr-en.js"></script>





  </body>
</html>
